# ğŸ¨ åœ¨çº¿æµç¨‹è®¾è®¡å™¨å®Œæ•´è®¾è®¡æ–¹æ¡ˆ

**éœ€æ±‚æ¥æº**: ç”¨æˆ·åé¦ˆç³»ç»Ÿç¼ºå°‘å¯è§†åŒ–æµç¨‹è®¾è®¡åŠŸèƒ½  
**æ ¸å¿ƒéœ€æ±‚**: ç®¡ç†å‘˜èƒ½ç”»ã€ä¿®æ”¹æµç¨‹å›¾å¹¶é‡æ–°å‘å¸ƒï¼Œå‘å¸ƒåæ‰èƒ½ç”Ÿæ•ˆ  
**è®¾è®¡æ—¶é—´**: 2025-11-15  
**è®¾è®¡çŠ¶æ€**: âœ… å®Œæ•´æ–¹æ¡ˆè®¾è®¡å®Œæˆ

---

## ğŸ“‹ ç›®å½•

1. [éœ€æ±‚åˆ†æ](#éœ€æ±‚åˆ†æ)
2. [æŠ€æœ¯é€‰å‹](#æŠ€æœ¯é€‰å‹)
3. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
4. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
5. [åç«¯APIè®¾è®¡](#åç«¯apiè®¾è®¡)
6. [å‰ç«¯è®¾è®¡](#å‰ç«¯è®¾è®¡)
7. [æƒé™æ§åˆ¶](#æƒé™æ§åˆ¶)
8. [å‘å¸ƒæµç¨‹](#å‘å¸ƒæµç¨‹)
9. [ç‰ˆæœ¬ç®¡ç†](#ç‰ˆæœ¬ç®¡ç†)
10. [å®æ–½è®¡åˆ’](#å®æ–½è®¡åˆ’)

---

## ğŸ“Š éœ€æ±‚åˆ†æ

### æ ¸å¿ƒéœ€æ±‚

| éœ€æ±‚é¡¹ | æè¿° | ä¼˜å…ˆçº§ |
|--------|------|--------|
| å¯è§†åŒ–è®¾è®¡ | ç®¡ç†å‘˜èƒ½åœ¨æµè§ˆå™¨ä¸­æ‹–æ‹½å¼è®¾è®¡BPMNæµç¨‹å›¾ | â­â­â­ å¿…é¡» |
| å±æ€§é…ç½® | é…ç½®ä»»åŠ¡åç§°ã€åŠç†äººã€ç›‘å¬å™¨ç­‰å±æ€§ | â­â­â­ å¿…é¡» |
| ä¿å­˜è‰ç¨¿ | ä¿å­˜æœªå®Œæˆçš„è®¾è®¡ï¼ŒçŠ¶æ€ä¸ºDRAFT | â­â­â­ å¿…é¡» |
| éªŒè¯BPMN | å‘å¸ƒå‰éªŒè¯BPMNè¯­æ³•å’Œé€»è¾‘æ­£ç¡®æ€§ | â­â­â­ å¿…é¡» |
| å‘å¸ƒæµç¨‹ | å°†è‰ç¨¿å‘å¸ƒä¸ºæ­£å¼æµç¨‹ï¼Œéƒ¨ç½²åˆ°Camundaå¼•æ“ | â­â­â­ å¿…é¡» |
| ç‰ˆæœ¬ç®¡ç† | æ¯æ¬¡å‘å¸ƒç”Ÿæˆæ–°ç‰ˆæœ¬ï¼Œæ”¯æŒæŸ¥çœ‹å†å²ç‰ˆæœ¬ | â­â­â­ å¿…é¡» |
| æƒé™æ§åˆ¶ | åªæœ‰ç®¡ç†å‘˜ï¼ˆADMINè§’è‰²ï¼‰å¯ä»¥æ“ä½œ | â­â­â­ å¿…é¡» |
| ä¿®æ”¹å·²å‘å¸ƒæµç¨‹ | åŸºäºå·²å‘å¸ƒæµç¨‹åˆ›å»ºæ–°ç‰ˆæœ¬è‰ç¨¿ï¼Œä¿®æ”¹åé‡æ–°å‘å¸ƒ | â­â­â­ å¿…é¡» |
| å†å²æŸ¥çœ‹ | æŸ¥çœ‹æµç¨‹çš„æ‰€æœ‰ç‰ˆæœ¬å’Œå˜æ›´å†å² | â­â­ é‡è¦ |
| æµç¨‹åˆ†ç±» | æŒ‰äººäº‹ã€è´¢åŠ¡ã€è¡Œæ”¿ç­‰åˆ†ç±»ç®¡ç† | â­ å¯é€‰ |

### ç”¨æˆ·è§’è‰²ä¸æƒé™

| è§’è‰² | æŸ¥çœ‹æµç¨‹åˆ—è¡¨ | æŸ¥çœ‹è®¾è®¡å™¨ | åˆ›å»ºæµç¨‹ | ç¼–è¾‘è‰ç¨¿ | å‘å¸ƒæµç¨‹ | åˆ é™¤æµç¨‹ |
|------|------------|------------|---------|---------|---------|---------|
| **ç®¡ç†å‘˜ï¼ˆADMINï¼‰** | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… |
| éƒ¨é—¨ç»ç†ï¼ˆMANAGERï¼‰ | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ |
| æ™®é€šå‘˜å·¥ï¼ˆEMPLOYEEï¼‰ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |

---

## ğŸ›  æŠ€æœ¯é€‰å‹

### å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç”¨é€” | ç†ç”± |
|------|------|------|
| **bpmn-js** | BPMNå¯è§†åŒ–è®¾è®¡å™¨ | Camundaå®˜æ–¹æ¨èï¼ŒåŠŸèƒ½å®Œå–„ï¼Œç¤¾åŒºæ´»è·ƒ |
| **bpmn-js-properties-panel** | å±æ€§é¢æ¿ | é…ç½®ä»»åŠ¡ã€ç½‘å…³ã€ç›‘å¬å™¨ç­‰å±æ€§ |
| **camunda-bpmn-moddle** | Camundaæ‰©å±• | æ”¯æŒCamundaç‰¹æœ‰çš„å±æ€§ï¼ˆå¦‚assigneeã€listenerï¼‰ |
| Vue 3 + Element Plus | UIæ¡†æ¶ | ä¸ç°æœ‰ç³»ç»Ÿä¸€è‡´ |
| Pinia | çŠ¶æ€ç®¡ç† | ç®¡ç†æµç¨‹è®¾è®¡çŠ¶æ€ |

### åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç”¨é€” | ç†ç”± |
|------|------|------|
| Spring Boot 2.4.11 | åç«¯æ¡†æ¶ | ä¸ç°æœ‰ç³»ç»Ÿä¸€è‡´ |
| Camunda 7.16.0 | æµç¨‹å¼•æ“ | BPMNéªŒè¯å’Œéƒ¨ç½² |
| MyBatis Plus | ORM | æ•°æ®åº“æ“ä½œ |
| MySQL | æ•°æ®åº“ | å­˜å‚¨BPMNè®¾è®¡æ•°æ® |

---

## ğŸ— ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·å±‚ï¼ˆæµè§ˆå™¨ï¼‰                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  æµç¨‹è®¾è®¡å™¨é¡µé¢ (ProcessDesigner.vue)              â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚
â”‚  â”‚  â”‚  bpmn-js ç”»å¸ƒ                                â”‚ â”‚     â”‚
â”‚  â”‚  â”‚  - æ‹–æ‹½ä»»åŠ¡ã€ç½‘å…³ã€äº‹ä»¶                      â”‚ â”‚     â”‚
â”‚  â”‚  â”‚  - è¿æ¥èŠ‚ç‚¹                                  â”‚ â”‚     â”‚
â”‚  â”‚  â”‚  - ç¼©æ”¾ã€å¹³ç§»ç”»å¸ƒ                            â”‚ â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚
â”‚  â”‚  â”‚  å±æ€§é¢æ¿                                    â”‚ â”‚     â”‚
â”‚  â”‚  â”‚  - ä»»åŠ¡åç§°ã€åŠç†äºº                          â”‚ â”‚     â”‚
â”‚  â”‚  â”‚  - ç›‘å¬å™¨é…ç½®                                â”‚ â”‚     â”‚
â”‚  â”‚  â”‚  - è¡¨å•é…ç½®                                  â”‚ â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚
â”‚  â”‚  â”‚  å·¥å…·æ                                       â”‚ â”‚     â”‚
â”‚  â”‚  â”‚  [ä¿å­˜è‰ç¨¿] [éªŒè¯] [å‘å¸ƒ] [å¯¼å‡ºXML] [æŸ¥çœ‹å†å²]â”‚ â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                            â†“ REST API                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        åº”ç”¨å±‚ï¼ˆSpring Bootï¼‰                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  ProcessDesignController                            â”‚     â”‚
â”‚  â”‚  - GET  /api/process-design/list           æŸ¥è¯¢åˆ—è¡¨â”‚     â”‚
â”‚  â”‚  - GET  /api/process-design/{id}           æŸ¥è¯¢è¯¦æƒ…â”‚     â”‚
â”‚  â”‚  - POST /api/process-design/save           ä¿å­˜è‰ç¨¿â”‚     â”‚
â”‚  â”‚  - POST /api/process-design/validate       éªŒè¯BPMNâ”‚     â”‚
â”‚  â”‚  - POST /api/process-design/publish        å‘å¸ƒæµç¨‹â”‚     â”‚
â”‚  â”‚  - GET  /api/process-design/{id}/history   æŸ¥è¯¢å†å²â”‚     â”‚
â”‚  â”‚  - POST /api/process-design/{id}/new-version æ–°ç‰ˆæœ¬â”‚     â”‚
â”‚  â”‚  - DELETE /api/process-design/{id}         åˆ é™¤è‰ç¨¿â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                            â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  ProcessDesignService                               â”‚     â”‚
â”‚  â”‚  - ä¸šåŠ¡é€»è¾‘å¤„ç†                                     â”‚     â”‚
â”‚  â”‚  - BPMNéªŒè¯ï¼ˆè¯­æ³•ã€é€»è¾‘ï¼‰                           â”‚     â”‚
â”‚  â”‚  - éƒ¨ç½²åˆ°Camundaå¼•æ“                                â”‚     â”‚
â”‚  â”‚  - ç‰ˆæœ¬ç®¡ç†                                         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                            â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Camunda RepositoryService                          â”‚     â”‚
â”‚  â”‚  - createDeployment() éƒ¨ç½²BPMN                      â”‚     â”‚
â”‚  â”‚  - getProcessDefinition() æŸ¥è¯¢æµç¨‹å®šä¹‰             â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                            â†“                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        æ•°æ®å±‚ï¼ˆMySQLï¼‰                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  workflow_process_design                            â”‚     â”‚
â”‚  â”‚  - å­˜å‚¨BPMN XML                                     â”‚     â”‚
â”‚  â”‚  - çŠ¶æ€ç®¡ç†ï¼ˆDRAFT/PUBLISHED/DEPRECATEDï¼‰           â”‚     â”‚
â”‚  â”‚  - ç‰ˆæœ¬æ§åˆ¶                                         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  workflow_process_design_history                    â”‚     â”‚
â”‚  â”‚  - å˜æ›´å†å²                                         â”‚     â”‚
â”‚  â”‚  - æ“ä½œå®¡è®¡                                         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Camundaè¡¨ï¼ˆact_re_procdefç­‰ï¼‰                      â”‚     â”‚
â”‚  â”‚  - å·²éƒ¨ç½²çš„æµç¨‹å®šä¹‰                                 â”‚     â”‚
â”‚  â”‚  - è¿è¡Œæ—¶æ•°æ®                                       â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ æ•°æ®åº“è®¾è®¡

### è¡¨ç»“æ„

#### 1. workflow_process_designï¼ˆæµç¨‹è®¾è®¡è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | BIGINT | ä¸»é”®ID |
| process_key | VARCHAR(100) | æµç¨‹å®šä¹‰Keyï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰ |
| process_name | VARCHAR(200) | æµç¨‹åç§° |
| version | INT | ç‰ˆæœ¬å·ï¼ˆä»1å¼€å§‹é€’å¢ï¼‰ |
| status | VARCHAR(20) | çŠ¶æ€ï¼šDRAFT-è‰ç¨¿, PUBLISHED-å·²å‘å¸ƒ, DEPRECATED-å·²åºŸå¼ƒ |
| bpmn_xml | LONGTEXT | BPMN XMLå†…å®¹ |
| description | VARCHAR(500) | æµç¨‹æè¿° |
| category | VARCHAR(50) | æµç¨‹åˆ†ç±» |
| deployment_id | VARCHAR(100) | Camundaéƒ¨ç½²IDï¼ˆå‘å¸ƒåç”Ÿæˆï¼‰ |
| process_definition_id | VARCHAR(100) | Camundaæµç¨‹å®šä¹‰IDï¼ˆå‘å¸ƒåç”Ÿæˆï¼‰ |
| deployed_at | DATETIME | éƒ¨ç½²æ—¶é—´ |
| creator | VARCHAR(100) | åˆ›å»ºäºº |
| creator_name | VARCHAR(100) | åˆ›å»ºäººå§“å |
| publisher | VARCHAR(100) | å‘å¸ƒäºº |
| publisher_name | VARCHAR(100) | å‘å¸ƒäººå§“å |
| publish_time | DATETIME | å‘å¸ƒæ—¶é—´ |
| create_time | DATETIME | åˆ›å»ºæ—¶é—´ |
| update_time | DATETIME | æ›´æ–°æ—¶é—´ |

**å”¯ä¸€ç´¢å¼•**: `uk_process_key_version` (process_key, version)

#### 2. workflow_process_design_historyï¼ˆæµç¨‹è®¾è®¡å˜æ›´å†å²è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | BIGINT | ä¸»é”®ID |
| design_id | BIGINT | æµç¨‹è®¾è®¡ID |
| process_key | VARCHAR(100) | æµç¨‹å®šä¹‰Key |
| version | INT | ç‰ˆæœ¬å· |
| action | VARCHAR(20) | æ“ä½œç±»å‹ï¼šCREATE-åˆ›å»º, UPDATE-æ›´æ–°, PUBLISH-å‘å¸ƒ, DEPRECATE-åºŸå¼ƒ |
| bpmn_xml | LONGTEXT | BPMN XMLå†…å®¹ï¼ˆå¿«ç…§ï¼‰ |
| change_description | VARCHAR(500) | å˜æ›´è¯´æ˜ |
| operator | VARCHAR(100) | æ“ä½œäºº |
| operator_name | VARCHAR(100) | æ“ä½œäººå§“å |
| create_time | DATETIME | æ“ä½œæ—¶é—´ |

### çŠ¶æ€è½¬æ¢å›¾

```
                 [åˆ›å»ºæ–°æµç¨‹]
                      â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  DRAFT (è‰ç¨¿) â”‚ â†â”€â”€â”€â”€â”€â”€â”
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
                      â”‚                â”‚
              [ä¿å­˜è‰ç¨¿/ä¿®æ”¹]           â”‚
                      â†“                â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
              â”‚  DRAFT (è‰ç¨¿) â”‚        â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
                      â”‚                â”‚
              [å‘å¸ƒæµç¨‹]               â”‚
                      â†“                â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
            â”‚ PUBLISHED (å·²å‘å¸ƒ) â”‚     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
                      â”‚                â”‚
            [åˆ›å»ºæ–°ç‰ˆæœ¬]               â”‚
                      â”‚                â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      
            [åºŸå¼ƒæµç¨‹]
                      â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ DEPRECATED (å·²åºŸå¼ƒ)â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”Œ åç«¯APIè®¾è®¡

### 1. æŸ¥è¯¢æµç¨‹åˆ—è¡¨

```http
GET /api/process-design/list
```

**è¯·æ±‚å‚æ•°**:
```json
{
  "status": "PUBLISHED",  // å¯é€‰ï¼šDRAFT, PUBLISHED, DEPRECATED, ALL
  "category": "äººäº‹",      // å¯é€‰ï¼šæµç¨‹åˆ†ç±»
  "keyword": "è¯·å‡",       // å¯é€‰ï¼šæœç´¢å…³é”®å­—ï¼ˆåŒ¹é…æµç¨‹åç§°ã€Keyï¼‰
  "page": 1,
  "pageSize": 10
}
```

**å“åº”**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 10,
    "list": [
      {
        "id": 1,
        "processKey": "leave-approval-process",
        "processName": "è¯·å‡å®¡æ‰¹æµç¨‹",
        "version": 2,
        "status": "PUBLISHED",
        "category": "äººäº‹",
        "description": "å‘˜å·¥è¯·å‡å®¡æ‰¹æµç¨‹",
        "creator": "admin",
        "creatorName": "ç®¡ç†å‘˜",
        "publisher": "admin",
        "publisherName": "ç®¡ç†å‘˜",
        "publishTime": "2025-11-15 14:00:00",
        "createTime": "2025-11-15 10:00:00",
        "updateTime": "2025-11-15 14:00:00",
        "hasNewerVersion": false  // æ˜¯å¦æœ‰æ›´æ–°ç‰ˆæœ¬
      }
    ]
  }
}
```

### 2. æŸ¥è¯¢æµç¨‹è¯¦æƒ…

```http
GET /api/process-design/{id}
```

**å“åº”**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "processKey": "leave-approval-process",
    "processName": "è¯·å‡å®¡æ‰¹æµç¨‹",
    "version": 2,
    "status": "PUBLISHED",
    "bpmnXml": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>...",
    "description": "å‘˜å·¥è¯·å‡å®¡æ‰¹æµç¨‹",
    "category": "äººäº‹",
    "deploymentId": "abc123",
    "processDefinitionId": "leave-approval-process:2:abc123",
    "creator": "admin",
    "publisher": "admin",
    "publishTime": "2025-11-15 14:00:00"
  }
}
```

### 3. ä¿å­˜è‰ç¨¿

```http
POST /api/process-design/save
```

**è¯·æ±‚ä½“**:
```json
{
  "id": null,  // æ–°å»ºæ—¶ä¸ºnullï¼Œæ›´æ–°æ—¶ä¼ ID
  "processKey": "leave-approval-process-v2",
  "processName": "è¯·å‡å®¡æ‰¹æµç¨‹V2",
  "bpmnXml": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>...",
  "description": "ä¼˜åŒ–å®¡æ‰¹æµç¨‹ï¼Œå¢åŠ HRå®¡æ‰¹ç¯èŠ‚",
  "category": "äººäº‹"
}
```

**å“åº”**:
```json
{
  "code": 200,
  "message": "ä¿å­˜æˆåŠŸ",
  "data": {
    "id": 5,
    "version": 1,
    "status": "DRAFT"
  }
}
```

### 4. éªŒè¯BPMN

```http
POST /api/process-design/validate
```

**è¯·æ±‚ä½“**:
```json
{
  "bpmnXml": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>..."
}
```

**å“åº”ï¼ˆéªŒè¯é€šè¿‡ï¼‰**:
```json
{
  "code": 200,
  "message": "éªŒè¯é€šè¿‡",
  "data": {
    "valid": true,
    "processKey": "leave-approval-process",
    "processName": "è¯·å‡å®¡æ‰¹æµç¨‹",
    "startEvents": 1,
    "userTasks": 2,
    "endEvents": 1
  }
}
```

**å“åº”ï¼ˆéªŒè¯å¤±è´¥ï¼‰**:
```json
{
  "code": 400,
  "message": "éªŒè¯å¤±è´¥",
  "data": {
    "valid": false,
    "errors": [
      {
        "line": 15,
        "column": 30,
        "message": "ä»»åŠ¡'fillLeaveForm'ç¼ºå°‘assigneeå±æ€§"
      },
      {
        "line": 20,
        "message": "æµç¨‹å¿…é¡»æœ‰ä¸”åªæœ‰ä¸€ä¸ªå¼€å§‹äº‹ä»¶"
      }
    ]
  }
}
```

### 5. å‘å¸ƒæµç¨‹

```http
POST /api/process-design/publish
```

**è¯·æ±‚ä½“**:
```json
{
  "id": 5,
  "changeDescription": "å¢åŠ HRå®¡æ‰¹ç¯èŠ‚ï¼Œä¼˜åŒ–å®¡æ‰¹æµç¨‹"
}
```

**å“åº”**:
```json
{
  "code": 200,
  "message": "å‘å¸ƒæˆåŠŸ",
  "data": {
    "id": 5,
    "version": 1,
    "status": "PUBLISHED",
    "deploymentId": "def456",
    "processDefinitionId": "leave-approval-process-v2:1:def456",
    "publishTime": "2025-11-15 15:00:00"
  }
}
```

### 6. æŸ¥è¯¢å˜æ›´å†å²

```http
GET /api/process-design/{id}/history
```

**å“åº”**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 10,
      "version": 2,
      "action": "PUBLISH",
      "changeDescription": "å¢åŠ HRå®¡æ‰¹ç¯èŠ‚",
      "operator": "admin",
      "operatorName": "ç®¡ç†å‘˜",
      "createTime": "2025-11-15 15:00:00"
    },
    {
      "id": 9,
      "version": 2,
      "action": "UPDATE",
      "changeDescription": "ä¿®æ”¹ä»»åŠ¡åç§°",
      "operator": "admin",
      "operatorName": "ç®¡ç†å‘˜",
      "createTime": "2025-11-15 14:30:00"
    }
  ]
}
```

### 7. åˆ›å»ºæ–°ç‰ˆæœ¬

```http
POST /api/process-design/{id}/new-version
```

**è¯´æ˜**: åŸºäºå·²å‘å¸ƒçš„æµç¨‹åˆ›å»ºæ–°ç‰ˆæœ¬è‰ç¨¿

**è¯·æ±‚ä½“**:
```json
{
  "changeDescription": "åŸºäºv1åˆ›å»ºæ–°ç‰ˆæœ¬ï¼Œå‡†å¤‡ä¼˜åŒ–æµç¨‹"
}
```

**å“åº”**:
```json
{
  "code": 200,
  "message": "æ–°ç‰ˆæœ¬åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": 6,
    "version": 2,
    "status": "DRAFT",
    "baseVersion": 1
  }
}
```

### 8. åˆ é™¤è‰ç¨¿

```http
DELETE /api/process-design/{id}
```

**è¯´æ˜**: åªèƒ½åˆ é™¤DRAFTçŠ¶æ€çš„æµç¨‹ï¼Œå·²å‘å¸ƒçš„æµç¨‹åªèƒ½åºŸå¼ƒ

**å“åº”**:
```json
{
  "code": 200,
  "message": "åˆ é™¤æˆåŠŸ"
}
```

---

## ğŸ¨ å‰ç«¯è®¾è®¡

### è·¯ç”±é…ç½®

```javascript
// diom-frontend/src/router/index.js
{
  path: '/workflow/designer',
  name: 'ProcessDesigner',
  component: () => import('@/views/Workflow/ProcessDesigner.vue'),
  meta: { 
    title: 'æµç¨‹è®¾è®¡å™¨', 
    requiresAuth: true,
    permission: 'workflow:design:manage'  // éœ€è¦ç®¡ç†å‘˜æƒé™
  }
},
{
  path: '/workflow/designer/:id',
  name: 'ProcessDesignerEdit',
  component: () => import('@/views/Workflow/ProcessDesigner.vue'),
  meta: { 
    title: 'ç¼–è¾‘æµç¨‹', 
    requiresAuth: true,
    permission: 'workflow:design:manage'
  }
}
```

### é¡µé¢ç»“æ„

```vue
<!-- diom-frontend/src/views/Workflow/ProcessDesigner.vue -->
<template>
  <div class="process-designer-container">
    <!-- é¡¶éƒ¨å·¥å…·æ  -->
    <div class="designer-toolbar">
      <el-input v-model="processName" placeholder="æµç¨‹åç§°" style="width: 300px" />
      <el-input v-model="processKey" placeholder="æµç¨‹Keyï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰" style="width: 200px" />
      <el-select v-model="category" placeholder="æµç¨‹åˆ†ç±»" style="width: 150px">
        <el-option label="äººäº‹" value="äººäº‹" />
        <el-option label="è´¢åŠ¡" value="è´¢åŠ¡" />
        <el-option label="è¡Œæ”¿" value="è¡Œæ”¿" />
      </el-select>
      
      <div class="toolbar-actions">
        <el-button @click="saveDraft" :loading="saving">
          <el-icon><DocumentAdd /></el-icon> ä¿å­˜è‰ç¨¿
        </el-button>
        <el-button @click="validate" :loading="validating">
          <el-icon><CircleCheck /></el-icon> éªŒè¯
        </el-button>
        <el-button type="primary" @click="publish" :loading="publishing">
          <el-icon><Upload /></el-icon> å‘å¸ƒ
        </el-button>
        <el-button @click="viewHistory">
          <el-icon><Clock /></el-icon> å†å²ç‰ˆæœ¬
        </el-button>
        <el-button @click="exportXML">
          <el-icon><Download /></el-icon> å¯¼å‡ºXML
        </el-button>
      </div>
    </div>
    
    <!-- ä¸»å†…å®¹åŒº -->
    <div class="designer-content">
      <!-- å·¦ä¾§ï¼šBPMNç”»å¸ƒ -->
      <div class="designer-canvas">
        <div ref="bpmnCanvas" class="bpmn-container"></div>
      </div>
      
      <!-- å³ä¾§ï¼šå±æ€§é¢æ¿ -->
      <div class="designer-properties">
        <div ref="propertiesPanel" class="properties-container"></div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import BpmnModeler from 'bpmn-js/lib/Modeler'
import {
  BpmnPropertiesPanelModule,
  BpmnPropertiesProviderModule
} from 'bpmn-js-properties-panel'
import CamundaBpmnModdle from 'camunda-bpmn-moddle/resources/camunda.json'

const bpmnCanvas = ref(null)
const propertiesPanel = ref(null)
let modeler = null

const processName = ref('')
const processKey = ref('')
const category = ref('')

onMounted(() => {
  initBpmnModeler()
})

const initBpmnModeler = () => {
  modeler = new BpmnModeler({
    container: bpmnCanvas.value,
    propertiesPanel: {
      parent: propertiesPanel.value
    },
    additionalModules: [
      BpmnPropertiesPanelModule,
      BpmnPropertiesProviderModule
    ],
    moddleExtensions: {
      camunda: CamundaBpmnModdle
    }
  })
  
  // åŠ è½½ç©ºç™½BPMNæˆ–å·²æœ‰BPMN
  if (route.params.id) {
    loadExistingProcess(route.params.id)
  } else {
    createNewProcess()
  }
}

const saveDraft = async () => {
  // è·å–BPMN XML
  const { xml } = await modeler.saveXML({ format: true })
  
  // è°ƒç”¨APIä¿å­˜
  await api.post('/api/process-design/save', {
    id: designId.value,
    processKey: processKey.value,
    processName: processName.value,
    bpmnXml: xml,
    category: category.value
  })
  
  ElMessage.success('ä¿å­˜æˆåŠŸ')
}

const validate = async () => {
  const { xml } = await modeler.saveXML({ format: true })
  
  const result = await api.post('/api/process-design/validate', {
    bpmnXml: xml
  })
  
  if (result.data.valid) {
    ElMessage.success('éªŒè¯é€šè¿‡')
  } else {
    // æ˜¾ç¤ºé”™è¯¯åˆ—è¡¨
    showValidationErrors(result.data.errors)
  }
}

const publish = async () => {
  await ElMessageBox.prompt('è¯·è¾“å…¥å˜æ›´è¯´æ˜', 'å‘å¸ƒæµç¨‹', {
    confirmButtonText: 'å‘å¸ƒ',
    cancelButtonText: 'å–æ¶ˆ'
  }).then(async ({ value }) => {
    await api.post('/api/process-design/publish', {
      id: designId.value,
      changeDescription: value
    })
    
    ElMessage.success('å‘å¸ƒæˆåŠŸ')
    router.push('/workflow/definitions')
  })
}
</script>
```

### NPMä¾èµ–

```json
{
  "dependencies": {
    "bpmn-js": "^14.0.0",
    "bpmn-js-properties-panel": "^3.0.0",
    "camunda-bpmn-moddle": "^7.0.0"
  }
}
```

---

## ğŸ”’ æƒé™æ§åˆ¶

### RBACæƒé™é…ç½®

åœ¨ `sys_permission` è¡¨ä¸­æ·»åŠ æ–°æƒé™ï¼š

```sql
INSERT INTO `sys_permission` (`permission_code`, `permission_name`, `permission_type`, `parent_id`, `sort_order`)
VALUES 
('workflow:design:view', 'æŸ¥çœ‹æµç¨‹è®¾è®¡', 'BUTTON', 
 (SELECT id FROM sys_permission WHERE permission_code = 'workflow:manage'), 1),
 
('workflow:design:create', 'åˆ›å»ºæµç¨‹è®¾è®¡', 'BUTTON', 
 (SELECT id FROM sys_permission WHERE permission_code = 'workflow:manage'), 2),
 
('workflow:design:edit', 'ç¼–è¾‘æµç¨‹è®¾è®¡', 'BUTTON', 
 (SELECT id FROM sys_permission WHERE permission_code = 'workflow:manage'), 3),
 
('workflow:design:publish', 'å‘å¸ƒæµç¨‹', 'BUTTON', 
 (SELECT id FROM sys_permission WHERE permission_code = 'workflow:manage'), 4),
 
('workflow:design:delete', 'åˆ é™¤æµç¨‹è®¾è®¡', 'BUTTON', 
 (SELECT id FROM sys_permission WHERE permission_code = 'workflow:manage'), 5);
```

### åç«¯æƒé™æ§åˆ¶

```java
@RestController
@RequestMapping("/api/process-design")
public class ProcessDesignController {
    
    @GetMapping("/list")
    @PreAuthorize("hasAuthority('workflow:design:view')")
    public Result<PageResult<ProcessDesignVO>> list(@RequestParam Map<String, Object> params) {
        // ...
    }
    
    @PostMapping("/save")
    @PreAuthorize("hasAnyAuthority('workflow:design:create', 'workflow:design:edit')")
    public Result<ProcessDesignVO> save(@RequestBody ProcessDesignDTO dto) {
        // ...
    }
    
    @PostMapping("/publish")
    @PreAuthorize("hasAuthority('workflow:design:publish')")
    public Result<ProcessDesignVO> publish(@RequestBody PublishDTO dto) {
        // ...
    }
    
    @DeleteMapping("/{id}")
    @PreAuthorize("hasAuthority('workflow:design:delete')")
    public Result<Void> delete(@PathVariable Long id) {
        // ...
    }
}
```

### å‰ç«¯æƒé™æ§åˆ¶

```vue
<!-- åªæœ‰æ‹¥æœ‰æƒé™çš„ç”¨æˆ·æ‰èƒ½çœ‹åˆ°æŒ‰é’® -->
<el-button 
  v-permission="'workflow:design:create'"
  @click="createProcess">
  æ–°å»ºæµç¨‹
</el-button>

<el-button 
  v-permission="'workflow:design:publish'"
  @click="publish">
  å‘å¸ƒ
</el-button>
```

---

## ğŸš€ å‘å¸ƒæµç¨‹

### å‘å¸ƒæµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ä¿å­˜è‰ç¨¿  â”‚ â†’ DRAFTçŠ¶æ€ï¼Œå­˜å…¥workflow_process_design
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. éªŒè¯BPMN  â”‚ â†’ æ£€æŸ¥è¯­æ³•ã€é€»è¾‘ã€å¿…å¡«å±æ€§
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
    [éªŒè¯é€šè¿‡?]
        â†“ Yes
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. å‘å¸ƒç¡®è®¤  â”‚ â†’ ç”¨æˆ·è¾“å…¥å˜æ›´è¯´æ˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. éƒ¨ç½²åˆ°å¼•æ“â”‚ â†’ Camunda RepositoryService.createDeployment()
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
    [éƒ¨ç½²æˆåŠŸ?]
        â†“ Yes
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. æ›´æ–°çŠ¶æ€  â”‚ â†’ workflow_process_design.status = 'PUBLISHED'
â”‚              â”‚   deployment_id, process_definition_id
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. è®°å½•å†å²  â”‚ â†’ workflow_process_design_history (action='PUBLISH')
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. å‘å¸ƒæˆåŠŸ  â”‚ â†’ æµç¨‹å¯ä»¥è¢«ç”¨æˆ·å‘èµ·äº†
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®ä»£ç 

```java
@Service
public class ProcessDesignService {
    
    @Autowired
    private RepositoryService repositoryService;
    
    @Transactional
    public ProcessDesignVO publish(Long id, String changeDescription, String operator) {
        // 1. æŸ¥è¯¢è‰ç¨¿
        ProcessDesign design = processDesignMapper.selectById(id);
        if (!"DRAFT".equals(design.getStatus())) {
            throw new BusinessException("åªèƒ½å‘å¸ƒè‰ç¨¿çŠ¶æ€çš„æµç¨‹");
        }
        
        // 2. éªŒè¯BPMN
        ValidationResult validation = validateBpmn(design.getBpmnXml());
        if (!validation.isValid()) {
            throw new BusinessException("BPMNéªŒè¯å¤±è´¥: " + validation.getErrors());
        }
        
        // 3. éƒ¨ç½²åˆ°Camundaå¼•æ“
        Deployment deployment = repositoryService.createDeployment()
            .name(design.getProcessName() + " v" + design.getVersion())
            .addString(design.getProcessKey() + ".bpmn", design.getBpmnXml())
            .deploy();
        
        // 4. è·å–æµç¨‹å®šä¹‰ID
        ProcessDefinition processDefinition = repositoryService
            .createProcessDefinitionQuery()
            .deploymentId(deployment.getId())
            .singleResult();
        
        // 5. æ›´æ–°è®¾è®¡çŠ¶æ€
        design.setStatus("PUBLISHED");
        design.setDeploymentId(deployment.getId());
        design.setProcessDefinitionId(processDefinition.getId());
        design.setPublisher(operator);
        design.setPublishTime(LocalDateTime.now());
        design.setDeployedAt(LocalDateTime.now());
        processDesignMapper.updateById(design);
        
        // 6. è®°å½•å†å²
        ProcessDesignHistory history = new ProcessDesignHistory();
        history.setDesignId(design.getId());
        history.setProcessKey(design.getProcessKey());
        history.setVersion(design.getVersion());
        history.setAction("PUBLISH");
        history.setBpmnXml(design.getBpmnXml());
        history.setChangeDescription(changeDescription);
        history.setOperator(operator);
        processDesignHistoryMapper.insert(history);
        
        return convert(design);
    }
}
```

---

## ğŸ“¦ ç‰ˆæœ¬ç®¡ç†

### ç‰ˆæœ¬ç®¡ç†ç­–ç•¥

1. **åŒä¸€æµç¨‹çš„ç‰ˆæœ¬é€’å¢**
   - `leave-approval-process` v1, v2, v3...
   - ç‰ˆæœ¬å·è‡ªåŠ¨é€’å¢
   - åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªPUBLISHEDç‰ˆæœ¬æ˜¯æœ€æ–°çš„

2. **åˆ›å»ºæ–°ç‰ˆæœ¬æµç¨‹**
   ```
   å·²å‘å¸ƒæµç¨‹ v1 (PUBLISHED)
        â†“ [ç‚¹å‡»"åˆ›å»ºæ–°ç‰ˆæœ¬"]
   æ–°å»ºè‰ç¨¿ v2 (DRAFT) â† å¤åˆ¶v1çš„BPMNå†…å®¹
        â†“ [ä¿®æ”¹å¹¶å‘å¸ƒ]
   å·²å‘å¸ƒæµç¨‹ v2 (PUBLISHED)
   å·²å‘å¸ƒæµç¨‹ v1 (PUBLISHED) â† ä»ä¿ç•™ï¼Œä½†ä¸æ˜¯æœ€æ–°ç‰ˆæœ¬
   ```

3. **ç‰ˆæœ¬æŸ¥è¯¢**
   - æŸ¥è¯¢æµç¨‹åˆ—è¡¨æ—¶ï¼Œé»˜è®¤åªæ˜¾ç¤ºæ¯ä¸ªprocess_keyçš„æœ€æ–°PUBLISHEDç‰ˆæœ¬
   - å¯ä»¥æŸ¥çœ‹æŸä¸ªæµç¨‹çš„æ‰€æœ‰å†å²ç‰ˆæœ¬
   - å¯ä»¥å›æ»šåˆ°å†å²ç‰ˆæœ¬ï¼ˆåˆ›å»ºåŸºäºå†å²ç‰ˆæœ¬çš„æ–°è‰ç¨¿ï¼‰

### ç‰ˆæœ¬ç®¡ç†API

```java
// æŸ¥è¯¢æŸä¸ªæµç¨‹çš„æ‰€æœ‰ç‰ˆæœ¬
GET /api/process-design/versions?processKey=leave-approval-process

// å“åº”
{
  "code": 200,
  "data": [
    {
      "id": 5,
      "version": 2,
      "status": "PUBLISHED",
      "publishTime": "2025-11-15 15:00:00",
      "isLatest": true
    },
    {
      "id": 1,
      "version": 1,
      "status": "PUBLISHED",
      "publishTime": "2025-11-15 10:00:00",
      "isLatest": false
    }
  ]
}

// åŸºäºæŸä¸ªç‰ˆæœ¬åˆ›å»ºæ–°è‰ç¨¿
POST /api/process-design/{id}/new-version
```

---

## ğŸ“… å®æ–½è®¡åˆ’

### å¼€å‘é˜¶æ®µ

| é˜¶æ®µ | ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | ä¼˜å…ˆçº§ |
|------|------|---------|--------|
| **Phase 1** | **æ•°æ®åº“å’Œå®ä½“** | **4å°æ—¶** | â­â­â­ |
| 1.1 | åˆ›å»ºæ•°æ®åº“è¡¨ï¼ˆprocess_design.sqlï¼‰ | 1å°æ—¶ | å¿…é¡» |
| 1.2 | åˆ›å»ºEntityå’ŒMapperï¼ˆProcessDesign, ProcessDesignHistoryï¼‰ | 2å°æ—¶ | å¿…é¡» |
| 1.3 | ç¼–å†™åŸºç¡€Serviceå’ŒController | 1å°æ—¶ | å¿…é¡» |
| **Phase 2** | **åç«¯æ ¸å¿ƒåŠŸèƒ½** | **12å°æ—¶** | â­â­â­ |
| 2.1 | å®ç°ä¿å­˜è‰ç¨¿API | 2å°æ—¶ | å¿…é¡» |
| 2.2 | å®ç°BPMNéªŒè¯é€»è¾‘ | 3å°æ—¶ | å¿…é¡» |
| 2.3 | å®ç°å‘å¸ƒæµç¨‹APIï¼ˆéƒ¨ç½²åˆ°Camundaï¼‰ | 3å°æ—¶ | å¿…é¡» |
| 2.4 | å®ç°ç‰ˆæœ¬ç®¡ç†API | 2å°æ—¶ | å¿…é¡» |
| 2.5 | å®ç°å†å²æŸ¥è¯¢API | 2å°æ—¶ | å¿…é¡» |
| **Phase 3** | **å‰ç«¯è®¾è®¡å™¨ç•Œé¢** | **16å°æ—¶** | â­â­â­ |
| 3.1 | å®‰è£…bpmn-jsä¾èµ–ï¼Œåˆå§‹åŒ–ç”»å¸ƒ | 2å°æ—¶ | å¿…é¡» |
| 3.2 | é›†æˆå±æ€§é¢æ¿ï¼ˆproperties-panelï¼‰ | 3å°æ—¶ | å¿…é¡» |
| 3.3 | å®ç°å·¥å…·æ ï¼ˆä¿å­˜ã€éªŒè¯ã€å‘å¸ƒï¼‰ | 3å°æ—¶ | å¿…é¡» |
| 3.4 | å®ç°æµç¨‹åˆ—è¡¨é¡µé¢ | 2å°æ—¶ | å¿…é¡» |
| 3.5 | å®ç°å†å²ç‰ˆæœ¬æŸ¥çœ‹ | 2å°æ—¶ | å¿…é¡» |
| 3.6 | æ ·å¼ä¼˜åŒ–å’Œäº¤äº’ä¼˜åŒ– | 4å°æ—¶ | é‡è¦ |
| **Phase 4** | **æƒé™é›†æˆå’Œæµ‹è¯•** | **8å°æ—¶** | â­â­â­ |
| 4.1 | æ·»åŠ RBACæƒé™é…ç½® | 2å°æ—¶ | å¿…é¡» |
| 4.2 | å‰åç«¯æƒé™æ§åˆ¶é›†æˆ | 2å°æ—¶ | å¿…é¡» |
| 4.3 | ç«¯åˆ°ç«¯åŠŸèƒ½æµ‹è¯• | 3å°æ—¶ | å¿…é¡» |
| 4.4 | æ–‡æ¡£ç¼–å†™ | 1å°æ—¶ | é‡è¦ |

**æ€»è®¡**: 40å°æ—¶ï¼ˆçº¦5ä¸ªå·¥ä½œæ—¥ï¼‰

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶

- [ ] ç®¡ç†å‘˜èƒ½è¿›å…¥æµç¨‹è®¾è®¡å™¨é¡µé¢
- [ ] èƒ½æ‹–æ‹½åˆ›å»ºå¼€å§‹äº‹ä»¶ã€ç”¨æˆ·ä»»åŠ¡ã€ç½‘å…³ã€ç»“æŸäº‹ä»¶
- [ ] èƒ½è¿æ¥èŠ‚ç‚¹å½¢æˆå®Œæ•´æµç¨‹
- [ ] èƒ½é…ç½®ä»»åŠ¡å±æ€§ï¼ˆåç§°ã€åŠç†äººã€ç›‘å¬å™¨ï¼‰
- [ ] èƒ½ä¿å­˜è‰ç¨¿ï¼ˆDRAFTçŠ¶æ€ï¼‰
- [ ] èƒ½éªŒè¯BPMNï¼ˆæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼‰
- [ ] èƒ½å‘å¸ƒæµç¨‹ï¼ˆéƒ¨ç½²åˆ°Camundaå¼•æ“ï¼‰
- [ ] å‘å¸ƒåèƒ½åœ¨æµç¨‹å®šä¹‰åˆ—è¡¨çœ‹åˆ°æ–°æµç¨‹
- [ ] ç”¨æˆ·èƒ½å‘èµ·å·²å‘å¸ƒçš„æµç¨‹
- [ ] èƒ½åŸºäºå·²å‘å¸ƒæµç¨‹åˆ›å»ºæ–°ç‰ˆæœ¬
- [ ] èƒ½æŸ¥çœ‹æµç¨‹çš„æ‰€æœ‰å†å²ç‰ˆæœ¬
- [ ] èƒ½æŸ¥çœ‹å˜æ›´å†å²è®°å½•
- [ ] éç®¡ç†å‘˜æ— æ³•è®¿é—®è®¾è®¡å™¨

### æ€§èƒ½éªŒæ”¶

- [ ] è®¾è®¡å™¨ç”»å¸ƒåŠ è½½æ—¶é—´ < 2ç§’
- [ ] ä¿å­˜è‰ç¨¿å“åº”æ—¶é—´ < 1ç§’
- [ ] å‘å¸ƒæµç¨‹å“åº”æ—¶é—´ < 3ç§’
- [ ] æ”¯æŒå¤æ‚æµç¨‹ï¼ˆ50+èŠ‚ç‚¹ï¼‰

### å®‰å…¨éªŒæ”¶

- [ ] æƒé™æ§åˆ¶ç”Ÿæ•ˆï¼ˆéç®¡ç†å‘˜æ— æ³•è®¿é—®ï¼‰
- [ ] BPMNéªŒè¯é˜²æ­¢æ¶æ„XML
- [ ] æ“ä½œå®¡è®¡è®°å½•å®Œæ•´

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

è¯·æ‚¨ç¡®è®¤ä»¥ä¸‹å‡ ç‚¹ï¼š

1. **æ˜¯å¦æ¥å—æ­¤è®¾è®¡æ–¹æ¡ˆï¼Ÿ**
2. **æ˜¯å¦ç°åœ¨å¼€å§‹å®æ–½ï¼Ÿ**
3. **å®æ–½é¡ºåºå»ºè®®**ï¼š
   - é€‰é¡¹Aï¼šå®Œæ•´å®æ–½ï¼ˆPhase 1-4ï¼Œçº¦5ä¸ªå·¥ä½œæ—¥ï¼‰
   - é€‰é¡¹Bï¼šMVPç‰ˆæœ¬ï¼ˆPhase 1-2 + ç®€åŒ–å‰ç«¯ï¼Œçº¦3ä¸ªå·¥ä½œæ—¥ï¼‰
   - é€‰é¡¹Cï¼šåˆ†é˜¶æ®µå®æ–½ï¼ˆå…ˆå®ŒæˆPhase 1-2ï¼ŒéªŒæ”¶åå†åšPhase 3-4ï¼‰

---

**è®¾è®¡æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**è®¾è®¡æ—¥æœŸ**: 2025-11-15  
**è®¾è®¡è€…**: AI Assistant  
**å®¡æ ¸çŠ¶æ€**: å¾…ç”¨æˆ·ç¡®è®¤

