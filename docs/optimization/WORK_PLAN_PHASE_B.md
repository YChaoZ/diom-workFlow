# æµç¨‹è®¾è®¡å™¨å®Œæ•´ç‰ˆä¼˜åŒ– - å·¥ä½œè®¡åˆ’ï¼ˆæ–¹æ¡ˆBï¼‰

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: æµç¨‹è®¾è®¡å™¨å®Œæ•´ç‰ˆä¼˜åŒ–  
**ç›®æ ‡**: æ‰“é€ ä¼ä¸šçº§BPMNæµç¨‹è®¾è®¡å™¨ï¼Œæ”¯æŒæ‰€æœ‰Camundaå±æ€§é…ç½®å’Œé«˜çº§åŠŸèƒ½  
**é¢„è®¡æ€»å·¥æ—¶**: 56-72å°æ—¶  
**é¢„è®¡å·¥æœŸ**: 7-9ä¸ªå·¥ä½œæ—¥  
**å¼€å§‹æ—¥æœŸ**: å¾…å®š  
**è´Ÿè´£äºº**: å¾…å®š

---

## ğŸ¯ æ€»ä½“ç›®æ ‡

å°†æµç¨‹è®¾è®¡å™¨ä»**åŸºç¡€æ‹–æ‹½å·¥å…·**å‡çº§ä¸º**ä¼ä¸šçº§æµç¨‹å»ºæ¨¡å¹³å°**ï¼š

### æ ¸å¿ƒèƒ½åŠ›
1. âœ… å®Œæ•´çš„BPMN 2.0å…ƒç´ æ”¯æŒ
2. âœ… æ‰€æœ‰Camundaå±æ€§å¯è§†åŒ–é…ç½®
3. âœ… è¡¨å•è®¾è®¡ä¸é›†æˆ
4. âœ… å®æ—¶éªŒè¯ä¸æ™ºèƒ½æç¤º
5. âœ… æµç¨‹æ¨¡æ‹Ÿè¿è¡Œ
6. âœ… æµç¨‹æ¨¡æ¿åº“
7. âœ… å¤šäººåä½œåŠŸèƒ½

### è´¨é‡æ ‡å‡†
- ğŸ¯ é›¶SQL/XMLæ‰‹åŠ¨ç¼–è¾‘
- ğŸ¯ ä¸šåŠ¡äººå‘˜å¯ç‹¬ç«‹å»ºæ¨¡
- ğŸ¯ é”™è¯¯ç‡é™ä½80%ä»¥ä¸Š
- ğŸ¯ å»ºæ¨¡æ•ˆç‡æå‡5å€ä»¥ä¸Š

---

## ğŸ“… å·¥ä½œé˜¶æ®µåˆ’åˆ†

### é˜¶æ®µ1: æ ¸å¿ƒåŠŸèƒ½ï¼ˆå¿…é¡»å®Œæˆï¼‰â­â­â­â­â­
**å·¥æ—¶**: 20-26å°æ—¶ | **å·¥æœŸ**: 2.5-3.5å¤©  
**ç›®æ ‡**: å®ç°åŸºæœ¬å¯ç”¨çš„æµç¨‹è®¾è®¡å™¨

### é˜¶æ®µ2: å¢å¼ºåŠŸèƒ½ï¼ˆé‡è¦åŠŸèƒ½ï¼‰â­â­â­â­
**å·¥æ—¶**: 20-26å°æ—¶ | **å·¥æœŸ**: 2.5-3.5å¤©  
**ç›®æ ‡**: æå‡ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿèƒ½åŠ›

### é˜¶æ®µ3: é«˜çº§åŠŸèƒ½ï¼ˆé”¦ä¸Šæ·»èŠ±ï¼‰â­â­â­
**å·¥æ—¶**: 16-20å°æ—¶ | **å·¥æœŸ**: 2-2.5å¤©  
**ç›®æ ‡**: è¾¾åˆ°ä¼ä¸šçº§æ ‡å‡†

---

## ğŸ”§ é˜¶æ®µ1: æ ¸å¿ƒåŠŸèƒ½ï¼ˆP0ï¼‰

### ä»»åŠ¡1.1: é›†æˆCamundaå±æ€§é¢æ¿ â­â­â­â­â­
**ä¼˜å…ˆçº§**: P0ï¼ˆæœ€é«˜ï¼‰  
**å·¥æ—¶**: 8-10å°æ—¶  
**è´Ÿè´£äºº**: å‰ç«¯å¼€å‘  
**ä¾èµ–**: æ— 

#### å­ä»»åŠ¡

##### 1.1.1 å®‰è£…NPMä¾èµ–ï¼ˆ15åˆ†é’Ÿï¼‰
```bash
cd diom-frontend
npm install bpmn-js-properties-panel@1.22.2
npm install camunda-bpmn-moddle@7.0.1
npm install camunda-bpmn-js-behaviors@0.5.0
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] `package.json`ä¸­åŒ…å«ä¸Šè¿°3ä¸ªä¾èµ–
- [ ] `npm list`å¯ä»¥çœ‹åˆ°ä¾èµ–ç‰ˆæœ¬
- [ ] æ— ç‰ˆæœ¬å†²çªè­¦å‘Š

---

##### 1.1.2 ä¿®æ”¹ProcessDesigner.vue - å¯¼å…¥æ¨¡å—ï¼ˆ30åˆ†é’Ÿï¼‰

**æ–‡ä»¶**: `diom-frontend/src/views/Workflow/ProcessDesigner.vue`

```javascript
// ===== åœ¨<script setup>é¡¶éƒ¨æ·»åŠ å¯¼å…¥ =====

// BPMNå±æ€§é¢æ¿ç›¸å…³
import {
  BpmnPropertiesPanelModule,
  BpmnPropertiesProviderModule,
  CamundaPlatformPropertiesProviderModule
} from 'bpmn-js-properties-panel'

// Camundaæ¨¡å—å®šä¹‰
import CamundaBpmnModdle from 'camunda-bpmn-moddle/resources/camunda.json'

// å±æ€§é¢æ¿æ ·å¼
import 'bpmn-js-properties-panel/dist/assets/properties-panel.css'

// Camundaè¡Œä¸ºæ¨¡å—ï¼ˆå¯é€‰ï¼Œç”¨äºé«˜çº§åŠŸèƒ½ï¼‰
import CamundaBehaviorsModule from 'camunda-bpmn-js-behaviors/lib/camunda-platform'
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] ç¼–è¯‘æ— é”™è¯¯
- [ ] æµè§ˆå™¨æ§åˆ¶å°æ— å¯¼å…¥é”™è¯¯

---

##### 1.1.3 ä¿®æ”¹ProcessDesigner.vue - æ›´æ–°modeleråˆå§‹åŒ–ï¼ˆ1å°æ—¶ï¼‰

**æ‰¾åˆ°`initBpmnModeler()`å‡½æ•°ï¼Œå®Œæ•´æ›¿æ¢ä¸º**:

```javascript
const initBpmnModeler = () => {
  modeler = new BpmnModeler({
    container: bpmnCanvas.value,
    // ===== æ–°å¢ï¼šå±æ€§é¢æ¿é…ç½® =====
    propertiesPanel: {
      parent: propertiesPanel.value
    },
    // ===== æ–°å¢ï¼šæ·»åŠ å±æ€§é¢æ¿æ¨¡å— =====
    additionalModules: [
      BpmnPropertiesPanelModule,
      BpmnPropertiesProviderModule,
      CamundaPlatformPropertiesProviderModule,
      CamundaBehaviorsModule  // å¯é€‰
    ],
    // ===== æ–°å¢ï¼šCamundaæ¨¡å—å®šä¹‰ =====
    moddleExtensions: {
      camunda: CamundaBpmnModdle
    },
    keyboard: {
      bindTo: document
    }
  })
  
  // ç›‘å¬æµç¨‹å˜åŒ–
  modeler.on('commandStack.changed', () => {
    // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ è‡ªåŠ¨ä¿å­˜é€»è¾‘
  })
  
  // ===== æ–°å¢ï¼šéšè—é»˜è®¤Paletteï¼ˆå› ä¸ºæˆ‘ä»¬æœ‰è‡ªå®šä¹‰Toolbarï¼‰ =====
  const canvas = modeler.get('canvas')
  const paletteContainer = canvas._container.parentNode.querySelector('.djs-palette')
  if (paletteContainer) {
    paletteContainer.style.display = 'none'
  }
}
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] ç¼–è¯‘æˆåŠŸ
- [ ] æ‰“å¼€è®¾è®¡å™¨é¡µé¢æ— é”™è¯¯
- [ ] å³ä¾§å±æ€§é¢æ¿å‡ºç°

---

##### 1.1.4 ä¼˜åŒ–å±æ€§é¢æ¿CSSæ ·å¼ï¼ˆ2å°æ—¶ï¼‰

**åœ¨`<style scoped>`ä¸­æ·»åŠ **:

```css
/* ===== å±æ€§é¢æ¿å®¹å™¨æ ·å¼ ===== */
.designer-properties {
  width: 320px;  /* å¢åŠ å®½åº¦ä»¥æ˜¾ç¤ºæ›´å¤šå†…å®¹ */
  background: #fff;
  overflow-y: auto;
  border-left: 1px solid #e4e7ed;
}

.properties-container {
  width: 100%;
  height: 100%;
}

/* ===== å±æ€§é¢æ¿æ•´ä½“æ ·å¼ ===== */
:deep(.bio-properties-panel) {
  background: #fafafa;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  font-size: 13px;
  color: #333;
}

/* ===== å±æ€§é¢æ¿å¤´éƒ¨ ===== */
:deep(.bio-properties-panel-header) {
  background: #fff;
  border-bottom: 2px solid #409eff;
  padding: 12px 15px;
  font-weight: 600;
  font-size: 14px;
  color: #409eff;
  position: sticky;
  top: 0;
  z-index: 10;
}

/* ===== å±æ€§åˆ†ç»„æ ‡é¢˜ ===== */
:deep(.bio-properties-panel-group-header) {
  background: #f5f7fa;
  padding: 10px 15px;
  font-weight: 600;
  font-size: 13px;
  border-top: 1px solid #e4e7ed;
  border-bottom: 1px solid #e4e7ed;
  color: #606266;
  cursor: pointer;
  transition: background-color 0.2s;
}

:deep(.bio-properties-panel-group-header:hover) {
  background: #ecf5ff;
}

/* ===== å±æ€§æ¡ç›® ===== */
:deep(.bio-properties-panel-entry) {
  padding: 12px 15px;
  border-bottom: 1px solid #f0f0f0;
  transition: background-color 0.2s;
}

:deep(.bio-properties-panel-entry:hover) {
  background: #f9f9f9;
}

/* ===== å±æ€§æ ‡ç­¾ ===== */
:deep(.bio-properties-panel-label) {
  display: block;
  margin-bottom: 6px;
  font-size: 12px;
  font-weight: 500;
  color: #606266;
}

/* ===== è¾“å…¥æ¡†æ ·å¼ ===== */
:deep(.bio-properties-panel-input),
:deep(.bio-properties-panel-textarea) {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid #dcdfe6;
  border-radius: 4px;
  font-size: 13px;
  color: #606266;
  background: #fff;
  transition: border-color 0.2s;
  box-sizing: border-box;
}

:deep(.bio-properties-panel-input:focus),
:deep(.bio-properties-panel-textarea:focus) {
  border-color: #409eff;
  outline: none;
  background: #fff;
}

:deep(.bio-properties-panel-input:disabled),
:deep(.bio-properties-panel-textarea:disabled) {
  background: #f5f7fa;
  color: #c0c4cc;
  cursor: not-allowed;
}

/* ===== ä¸‹æ‹‰é€‰æ‹©æ¡†æ ·å¼ ===== */
:deep(.bio-properties-panel-select) {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid #dcdfe6;
  border-radius: 4px;
  font-size: 13px;
  background: #fff;
  cursor: pointer;
}

:deep(.bio-properties-panel-select:focus) {
  border-color: #409eff;
  outline: none;
}

/* ===== å¤é€‰æ¡†æ ·å¼ ===== */
:deep(.bio-properties-panel-checkbox) {
  margin-right: 6px;
  cursor: pointer;
}

/* ===== æŒ‰é’®æ ·å¼ ===== */
:deep(.bio-properties-panel-button) {
  padding: 6px 12px;
  border: 1px solid #dcdfe6;
  border-radius: 4px;
  background: #fff;
  color: #606266;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s;
}

:deep(.bio-properties-panel-button:hover) {
  background: #ecf5ff;
  border-color: #409eff;
  color: #409eff;
}

/* ===== åˆ—è¡¨æ ·å¼ ===== */
:deep(.bio-properties-panel-list) {
  border: 1px solid #e4e7ed;
  border-radius: 4px;
  overflow: hidden;
}

:deep(.bio-properties-panel-list-entry) {
  padding: 8px 12px;
  border-bottom: 1px solid #f0f0f0;
  background: #fff;
  cursor: pointer;
  transition: background-color 0.2s;
}

:deep(.bio-properties-panel-list-entry:hover) {
  background: #f5f7fa;
}

:deep(.bio-properties-panel-list-entry:last-child) {
  border-bottom: none;
}

/* ===== é”™è¯¯æç¤ºæ ·å¼ ===== */
:deep(.bio-properties-panel-error) {
  color: #f56c6c;
  font-size: 12px;
  margin-top: 4px;
}

/* ===== å¸®åŠ©æç¤ºæ ·å¼ ===== */
:deep(.bio-properties-panel-description) {
  color: #909399;
  font-size: 11px;
  margin-top: 4px;
  line-height: 1.4;
}

/* ===== æŠ˜å /å±•å¼€å›¾æ ‡ ===== */
:deep(.bio-properties-panel-group-header-icon) {
  float: right;
  transition: transform 0.2s;
}

:deep(.bio-properties-panel-group--collapsed .bio-properties-panel-group-header-icon) {
  transform: rotate(-90deg);
}

/* ===== æ»šåŠ¨æ¡æ ·å¼ ===== */
.designer-properties::-webkit-scrollbar {
  width: 8px;
}

.designer-properties::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 4px;
}

.designer-properties::-webkit-scrollbar-thumb:hover {
  background: #a8a8a8;
}

.designer-properties::-webkit-scrollbar-track {
  background: #f1f1f1;
}
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] å±æ€§é¢æ¿æ ·å¼ç¾è§‚
- [ ] ä¸Element Plusé£æ ¼ä¸€è‡´
- [ ] è¾“å…¥æ¡†ã€æŒ‰é’®äº¤äº’æ­£å¸¸

---

##### 1.1.5 æµ‹è¯•å±æ€§é¢æ¿åŠŸèƒ½ï¼ˆ2å°æ—¶ï¼‰

**æµ‹è¯•æ¸…å•**:

1. **ç”¨æˆ·ä»»åŠ¡å±æ€§æµ‹è¯•**
   - [ ] ç‚¹å‡»ç”¨æˆ·ä»»åŠ¡ï¼Œå³ä¾§æ˜¾ç¤ºå±æ€§
   - [ ] å¯ä»¥é…ç½®Assigneeï¼ˆå›ºå®šç”¨æˆ·ï¼‰
   - [ ] å¯ä»¥é…ç½®Assignee Expressionï¼ˆè¡¨è¾¾å¼ï¼‰
   - [ ] å¯ä»¥é…ç½®Candidate Users
   - [ ] å¯ä»¥é…ç½®Candidate Groups
   - [ ] å¯ä»¥é…ç½®Due Date
   - [ ] å¯ä»¥é…ç½®Priority

2. **æœåŠ¡ä»»åŠ¡å±æ€§æµ‹è¯•**
   - [ ] å¯ä»¥é…ç½®Java Class
   - [ ] å¯ä»¥é…ç½®Expression
   - [ ] å¯ä»¥é…ç½®Delegate Expression
   - [ ] å¯ä»¥é…ç½®External Task

3. **ç½‘å…³å±æ€§æµ‹è¯•**
   - [ ] å¯ä»¥é…ç½®Default Flow
   - [ ] å¯ä»¥é…ç½®Condition Expression

4. **æµç¨‹å±æ€§æµ‹è¯•**
   - [ ] å¯ä»¥é…ç½®æµç¨‹ID
   - [ ] å¯ä»¥é…ç½®æµç¨‹åç§°
   - [ ] å¯ä»¥é…ç½®Executable
   - [ ] å¯ä»¥é…ç½®Candidate Starter Groups

5. **ä¿å­˜ä¸å‘å¸ƒæµ‹è¯•**
   - [ ] é…ç½®å±æ€§åä¿å­˜è‰ç¨¿æˆåŠŸ
   - [ ] è‰ç¨¿ä¸­åŒ…å«é…ç½®çš„å±æ€§
   - [ ] å‘å¸ƒæµç¨‹æˆåŠŸ
   - [ ] å‘å¸ƒåBPMN XMLåŒ…å«Camundaå±æ€§

**æµ‹è¯•è„šæœ¬**:
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ
const modeler = window.modeler  // éœ€è¦å°†modeleræš´éœ²åˆ°window
const elementRegistry = modeler.get('elementRegistry')
const modeling = modeler.get('modeling')

// è·å–æ‰€æœ‰ç”¨æˆ·ä»»åŠ¡
const userTasks = elementRegistry.filter(el => el.type === 'bpmn:UserTask')
console.log('ç”¨æˆ·ä»»åŠ¡åˆ—è¡¨:', userTasks)

// æ£€æŸ¥ç¬¬ä¸€ä¸ªç”¨æˆ·ä»»åŠ¡çš„å±æ€§
const task = userTasks[0]
console.log('ä»»åŠ¡å±æ€§:', task.businessObject)
console.log('Assignee:', task.businessObject.assignee)
console.log('Candidate Users:', task.businessObject.candidateUsers)
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ‰€æœ‰æµ‹è¯•é¡¹é€šè¿‡
- [ ] æ— JavaScripté”™è¯¯
- [ ] å±æ€§é…ç½®å¯æ­£ç¡®ä¿å­˜åˆ°æ•°æ®åº“

---

### ä»»åŠ¡1.2: å¯ç”¨å…ƒç´ è¿æ¥åŠŸèƒ½ â­â­â­â­
**ä¼˜å…ˆçº§**: P0  
**å·¥æ—¶**: 4-6å°æ—¶  
**è´Ÿè´£äºº**: å‰ç«¯å¼€å‘  
**ä¾èµ–**: ä»»åŠ¡1.1å®Œæˆ

#### å­ä»»åŠ¡

##### 1.2.1 å¯ç”¨Context Padæ¨¡å—ï¼ˆ1å°æ—¶ï¼‰

**ä¿®æ”¹`ProcessDesigner.vue`çš„`initBpmnModeler()`**:

```javascript
// å¯¼å…¥Context Padæ¨¡å—
import ContextPadModule from 'diagram-js/lib/features/context-pad'

// åœ¨additionalModulesä¸­æ·»åŠ 
modeler = new BpmnModeler({
  // ... å…¶ä»–é…ç½®
  additionalModules: [
    BpmnPropertiesPanelModule,
    BpmnPropertiesProviderModule,
    CamundaPlatformPropertiesProviderModule,
    ContextPadModule  // â­ æ–°å¢ï¼šå¯ç”¨å…ƒç´ å‘¨å›´çš„å¿«æ·èœå•
  ]
})
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] ç‚¹å‡»å…ƒç´ æ—¶ï¼Œå‘¨å›´å‡ºç°æ“ä½œèœå•
- [ ] å¯ä»¥é€šè¿‡èœå•æ·»åŠ è¿æ¥çº¿
- [ ] å¯ä»¥é€šè¿‡èœå•åˆ é™¤å…ƒç´ 

---

##### 1.2.2 æ·»åŠ è¿æ¥å·¥å…·åˆ°Toolbarï¼ˆ2å°æ—¶ï¼‰

**ä¿®æ”¹`Toolbar.vue`ï¼Œæ·»åŠ å·¥å…·ç±»**:

```vue
<script setup>
// åœ¨å·¥å…·åˆ—è¡¨ä¸­æ·»åŠ è¿æ¥å·¥å…·
const tools = ref([
  {
    type: 'hand-tool',
    label: 'æ‰‹å‹å·¥å…·',
    icon: 'âœ‹',
    color: '#67c23a',
    bpmnType: 'hand-tool'
  },
  {
    type: 'lasso-tool',
    label: 'å¥—ç´¢é€‰æ‹©',
    icon: 'â­•',
    color: '#409eff',
    bpmnType: 'lasso-tool'
  },
  {
    type: 'space-tool',
    label: 'ç©ºé—´è°ƒæ•´',
    icon: 'â†”ï¸',
    color: '#909399',
    bpmnType: 'space-tool'
  },
  {
    type: 'create-connection',
    label: 'è¿æ¥å·¥å…·',
    icon: 'ğŸ”—',
    color: '#e6a23c',
    bpmnType: 'global-connect-tool'
  }
])
</script>

<template>
  <!-- å·¥å…·éƒ¨åˆ†ï¼ˆåœ¨å…¶ä»–åˆ†ç±»ä¹‹å‰ï¼‰ -->
  <div class="toolbar-section">
    <div class="section-title">å·¥å…·</div>
    <div 
      v-for="item in tools"
      :key="item.type"
      class="toolbar-item"
      @click="handleToolClick(item)"
      :title="item.label"
    >
      <div class="item-icon" :style="{ backgroundColor: item.color }">
        {{ item.icon }}
      </div>
      <div class="item-label">{{ item.label }}</div>
    </div>
  </div>
  
  <!-- åŸæœ‰çš„äº‹ä»¶ã€ä»»åŠ¡ç­‰åˆ†ç±» -->
</template>
```

**åœ¨`ProcessDesigner.vue`ä¸­å¤„ç†å·¥å…·ç‚¹å‡»**:

```javascript
// å¤„ç†å·¥å…·æ å·¥å…·ç‚¹å‡»
const handleToolClick = (tool) => {
  if (!modeler) return
  
  const globalConnect = modeler.get('globalConnect')
  const handTool = modeler.get('handTool')
  const lassoTool = modeler.get('lassoTool')
  const spaceTool = modeler.get('spaceTool')
  
  // å–æ¶ˆæ‰€æœ‰å·¥å…·çš„æ¿€æ´»çŠ¶æ€
  globalConnect.toggle(false)
  handTool.toggle(false)
  lassoTool.toggle(false)
  spaceTool.toggle(false)
  
  // æ¿€æ´»é€‰ä¸­çš„å·¥å…·
  switch (tool.bpmnType) {
    case 'global-connect-tool':
      globalConnect.toggle()
      break
    case 'hand-tool':
      handTool.toggle()
      break
    case 'lasso-tool':
      lassoTool.toggle()
      break
    case 'space-tool':
      spaceTool.toggle()
      break
  }
}

// åœ¨æ¨¡æ¿ä¸­ç›‘å¬å·¥å…·ç‚¹å‡»äº‹ä»¶
<Toolbar 
  @drag-start="handleToolbarDragStart"
  @tool-click="handleToolClick"  // â­ æ–°å¢
/>
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] ç‚¹å‡»è¿æ¥å·¥å…·åï¼Œé¼ æ ‡å˜ä¸ºè¿æ¥æ¨¡å¼
- [ ] å¯ä»¥ç‚¹å‡»èµ·å§‹å…ƒç´ æ‹–åŠ¨åˆ°ç›®æ ‡å…ƒç´ åˆ›å»ºè¿æ¥
- [ ] è¿æ¥çº¿æ ·å¼æ­£å¸¸
- [ ] å…¶ä»–å·¥å…·ï¼ˆæ‰‹å‹ã€å¥—ç´¢ï¼‰ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œ

---

##### 1.2.3 æµ‹è¯•è¿æ¥åŠŸèƒ½ï¼ˆ1å°æ—¶ï¼‰

**æµ‹è¯•æ¸…å•**:
- [ ] å¼€å§‹äº‹ä»¶â†’ç”¨æˆ·ä»»åŠ¡ï¼ˆåˆ›å»ºSequenceFlowï¼‰
- [ ] ç”¨æˆ·ä»»åŠ¡â†’ç½‘å…³ï¼ˆåˆ›å»ºSequenceFlowï¼‰
- [ ] ç½‘å…³â†’ç»“æŸäº‹ä»¶ï¼ˆåˆ›å»ºSequenceFlowï¼‰
- [ ] ä»»åŠ¡â†’ä»»åŠ¡ï¼ˆåˆ›å»ºSequenceFlowï¼‰
- [ ] åˆ é™¤è¿æ¥çº¿
- [ ] ä¿®æ”¹è¿æ¥çº¿çš„å¼¯æ›²ç‚¹
- [ ] ä¿å­˜åé‡æ–°æ‰“å¼€ï¼Œè¿æ¥çº¿ä¿æŒ

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ‰€æœ‰è¿æ¥æ“ä½œæ­£å¸¸
- [ ] è¿æ¥çº¿å¯ä»¥è‡ªåŠ¨è·¯ç”±
- [ ] ä¿å­˜åæ•°æ®æ­£ç¡®

---

### ä»»åŠ¡1.3: æ·»åŠ åŸºæœ¬ç¼–è¾‘åŠŸèƒ½ â­â­â­
**ä¼˜å…ˆçº§**: P1  
**å·¥æ—¶**: 4-6å°æ—¶  
**è´Ÿè´£äºº**: å‰ç«¯å¼€å‘  
**ä¾èµ–**: ä»»åŠ¡1.1ã€1.2å®Œæˆ

#### å­ä»»åŠ¡

##### 1.3.1 å¯ç”¨é”®ç›˜å¿«æ·é”®ï¼ˆ2å°æ—¶ï¼‰

```javascript
// å¯¼å…¥é”®ç›˜æ¨¡å—
import KeyboardModule from 'diagram-js/lib/features/keyboard'
import KeyboardMoveSelectionModule from 'diagram-js/lib/features/keyboard-move-selection'

// åœ¨additionalModulesä¸­æ·»åŠ 
modeler = new BpmnModeler({
  additionalModules: [
    // ... å…¶ä»–æ¨¡å—
    KeyboardModule,
    KeyboardMoveSelectionModule
  ],
  keyboard: {
    bindTo: document  // ç»‘å®šåˆ°æ•´ä¸ªæ–‡æ¡£
  }
})
```

**æ”¯æŒçš„å¿«æ·é”®**:
- `Delete` / `Backspace`: åˆ é™¤é€‰ä¸­å…ƒç´ 
- `Ctrl+C`: å¤åˆ¶
- `Ctrl+V`: ç²˜è´´
- `Ctrl+Z`: æ’¤é”€
- `Ctrl+Y` / `Ctrl+Shift+Z`: é‡åš
- `Ctrl+A`: å…¨é€‰
- `æ–¹å‘é”®`: ç§»åŠ¨é€‰ä¸­å…ƒç´ 
- `Ctrl+æ–¹å‘é”®`: å¿«é€Ÿç§»åŠ¨

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ‰€æœ‰å¿«æ·é”®åŠŸèƒ½æ­£å¸¸
- [ ] ä¸ä¸æµè§ˆå™¨å¿«æ·é”®å†²çª
- [ ] åœ¨è¾“å…¥æ¡†å†…ä¸è§¦å‘å¿«æ·é”®

---

##### 1.3.2 æ·»åŠ å³é”®èœå•ï¼ˆ2å°æ—¶ï¼‰

```javascript
// å¯¼å…¥Pop-up Menuæ¨¡å—
import PopupMenuModule from 'diagram-js/lib/features/popup-menu'

// è‡ªå®šä¹‰å³é”®èœå•
class CustomPopupMenuProvider {
  constructor(popupMenu, modeling, translate) {
    this._popupMenu = popupMenu
    this._modeling = modeling
    this._translate = translate
    
    popupMenu.registerProvider('bpmn-replace', this)
  }
  
  getPopupMenuEntries(element) {
    const modeling = this._modeling
    const translate = this._translate
    
    return {
      'delete': {
        label: translate('åˆ é™¤'),
        className: 'bpmn-icon-trash',
        action: () => {
          modeling.removeElements([element])
        }
      },
      'copy': {
        label: translate('å¤åˆ¶'),
        className: 'bpmn-icon-copy',
        action: () => {
          // å¤åˆ¶é€»è¾‘
        }
      },
      'properties': {
        label: translate('å±æ€§'),
        className: 'bpmn-icon-properties',
        action: () => {
          // æ‰“å¼€å±æ€§é¢æ¿
        }
      }
    }
  }
}

// æ³¨å†Œè‡ªå®šä¹‰èœå•æä¾›å™¨
modeler = new BpmnModeler({
  additionalModules: [
    PopupMenuModule,
    {
      __init__: ['customPopupMenuProvider'],
      customPopupMenuProvider: ['type', CustomPopupMenuProvider]
    }
  ]
})
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] å³é”®ç‚¹å‡»å…ƒç´ æ˜¾ç¤ºèœå•
- [ ] èœå•é¡¹æ­£å¸¸å·¥ä½œ
- [ ] èœå•æ ·å¼ç¾è§‚

---

##### 1.3.3 æ·»åŠ ç¼–è¾‘å·¥å…·æ ï¼ˆ1å°æ—¶ï¼‰

**åœ¨ProcessDesigner.vueçš„é¡¶éƒ¨å·¥å…·æ æ·»åŠ ç¼–è¾‘æŒ‰é’®**:

```vue
<template>
  <div class="designer-toolbar">
    <div class="toolbar-left">
      <!-- åŸæœ‰çš„æµç¨‹ä¿¡æ¯è¾“å…¥ -->
      <el-input v-model="processName" placeholder="æµç¨‹åç§°" />
      <!-- ... -->
    </div>
    
    <!-- â­ æ–°å¢ï¼šç¼–è¾‘å·¥å…·æ  -->
    <div class="toolbar-center">
      <el-button-group>
        <el-button @click="handleUndo" :disabled="!canUndo">
          <el-icon><RefreshLeft /></el-icon> æ’¤é”€
        </el-button>
        <el-button @click="handleRedo" :disabled="!canRedo">
          <el-icon><RefreshRight /></el-icon> é‡åš
        </el-button>
      </el-button-group>
      
      <el-button-group style="margin-left: 10px">
        <el-button @click="handleCopy" :disabled="!hasSelection">
          <el-icon><DocumentCopy /></el-icon> å¤åˆ¶
        </el-button>
        <el-button @click="handlePaste" :disabled="!hasClipboard">
          <el-icon><DocumentAdd /></el-icon> ç²˜è´´
        </el-button>
        <el-button @click="handleDelete" :disabled="!hasSelection">
          <el-icon><Delete /></el-icon> åˆ é™¤
        </el-button>
      </el-button-group>
      
      <el-button-group style="margin-left: 10px">
        <el-button @click="handleZoomIn">
          <el-icon><ZoomIn /></el-icon> æ”¾å¤§
        </el-button>
        <el-button @click="handleZoomOut">
          <el-icon><ZoomOut /></el-icon> ç¼©å°
        </el-button>
        <el-button @click="handleZoomReset">
          <el-icon><FullScreen /></el-icon> é€‚åº”
        </el-button>
      </el-button-group>
    </div>
    
    <div class="toolbar-right">
      <!-- åŸæœ‰çš„æ“ä½œæŒ‰é’® -->
    </div>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue'
import { 
  RefreshLeft, RefreshRight, 
  DocumentCopy, DocumentAdd, Delete,
  ZoomIn, ZoomOut, FullScreen
} from '@element-plus/icons-vue'

const canUndo = ref(false)
const canRedo = ref(false)
const hasSelection = ref(false)
const hasClipboard = ref(false)

// ç›‘å¬commandStackå˜åŒ–
modeler.on('commandStack.changed', () => {
  const commandStack = modeler.get('commandStack')
  canUndo.value = commandStack.canUndo()
  canRedo.value = commandStack.canRedo()
})

// ç›‘å¬é€‰æ‹©å˜åŒ–
modeler.on('selection.changed', (event) => {
  hasSelection.value = event.newSelection.length > 0
})

// ç¼–è¾‘æ“ä½œ
const handleUndo = () => {
  const commandStack = modeler.get('commandStack')
  commandStack.undo()
}

const handleRedo = () => {
  const commandStack = modeler.get('commandStack')
  commandStack.redo()
}

const handleCopy = () => {
  const clipboard = modeler.get('clipboard')
  const selection = modeler.get('selection')
  const copyPaste = modeler.get('copyPaste')
  
  copyPaste.copy(selection.get())
  hasClipboard.value = true
}

const handlePaste = () => {
  const copyPaste = modeler.get('copyPaste')
  copyPaste.paste()
}

const handleDelete = () => {
  const modeling = modeler.get('modeling')
  const selection = modeler.get('selection')
  
  modeling.removeElements(selection.get())
}

// ç¼©æ”¾æ“ä½œ
const handleZoomIn = () => {
  const zoomScroll = modeler.get('zoomScroll')
  zoomScroll.stepZoom(1)
}

const handleZoomOut = () => {
  const zoomScroll = modeler.get('zoomScroll')
  zoomScroll.stepZoom(-1)
}

const handleZoomReset = () => {
  const canvas = modeler.get('canvas')
  canvas.zoom('fit-viewport')
}
</script>
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] ç¼–è¾‘æŒ‰é’®æ˜¾ç¤ºæ­£å¸¸
- [ ] æŒ‰é’®çŠ¶æ€éšæ“ä½œå˜åŒ–
- [ ] æ‰€æœ‰ç¼–è¾‘æ“ä½œæ­£å¸¸å·¥ä½œ

---

### ä»»åŠ¡1.4: ä¼˜åŒ–UIäº¤äº’ä½“éªŒ â­â­â­
**ä¼˜å…ˆçº§**: P1  
**å·¥æ—¶**: 4-6å°æ—¶  
**è´Ÿè´£äºº**: å‰ç«¯å¼€å‘  
**ä¾èµ–**: ä»»åŠ¡1.1ã€1.2ã€1.3å®Œæˆ

#### å­ä»»åŠ¡

##### 1.4.1 æ·»åŠ Miniåœ°å›¾ï¼ˆ1å°æ—¶ï¼‰

```javascript
import MiniMapModule from 'diagram-js-minimap'

modeler = new BpmnModeler({
  additionalModules: [
    // ... å…¶ä»–æ¨¡å—
    MiniMapModule
  ]
})
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] å³ä¸‹è§’æ˜¾ç¤ºMiniåœ°å›¾
- [ ] å¯ä»¥é€šè¿‡Miniåœ°å›¾å¿«é€Ÿå¯¼èˆª
- [ ] Miniåœ°å›¾æ ·å¼ç¾è§‚

---

##### 1.4.2 æ·»åŠ ç½‘æ ¼èƒŒæ™¯ï¼ˆ30åˆ†é’Ÿï¼‰

```css
:deep(.djs-container) {
  background-color: #fafafa;
  background-image: 
    linear-gradient(#e4e7ed 1px, transparent 1px),
    linear-gradient(90deg, #e4e7ed 1px, transparent 1px);
  background-size: 20px 20px;
}
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] ç”»å¸ƒæ˜¾ç¤ºç½‘æ ¼èƒŒæ™¯
- [ ] ç½‘æ ¼å¤§å°é€‚ä¸­
- [ ] ä¸å½±å“å…ƒç´ æ˜¾ç¤º

---

##### 1.4.3 æ·»åŠ å…ƒç´ é«˜äº®æ•ˆæœï¼ˆ1å°æ—¶ï¼‰

```javascript
// ç›‘å¬é¼ æ ‡æ‚¬åœ
modeler.on('element.hover', (event) => {
  const canvas = modeler.get('canvas')
  canvas.addMarker(event.element.id, 'highlight')
})

modeler.on('element.out', (event) => {
  const canvas = modeler.get('canvas')
  canvas.removeMarker(event.element.id, 'highlight')
})
```

```css
:deep(.highlight) {
  stroke: #409eff !important;
  stroke-width: 3px !important;
}
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] é¼ æ ‡æ‚¬åœæ—¶å…ƒç´ é«˜äº®
- [ ] é«˜äº®æ•ˆæœæ˜æ˜¾ä½†ä¸åˆºçœ¼
- [ ] ç§»å¼€é¼ æ ‡åæ¢å¤æ­£å¸¸

---

## ğŸ“Š é˜¶æ®µ1æ€»ç»“

**é¢„è®¡å®Œæˆæ—¶é—´**: 20-26å°æ—¶ï¼ˆ2.5-3.5å¤©ï¼‰

**äº¤ä»˜ç‰©æ¸…å•**:
- [x] ProcessDesigner.vueï¼ˆå®Œæ•´ä¿®æ”¹ï¼‰
- [x] Toolbar.vueï¼ˆæ·»åŠ å·¥å…·ï¼‰
- [x] package.jsonï¼ˆæ–°å¢ä¾èµ–ï¼‰
- [x] æµ‹è¯•æŠ¥å‘Šï¼ˆåŠŸèƒ½éªŒè¯ï¼‰

**éªŒæ”¶æ ‡å‡†**:
- [ ] å±æ€§é¢æ¿å®Œæ•´æ˜¾ç¤ºå¹¶å¯é…ç½®æ‰€æœ‰Camundaå±æ€§
- [ ] å…ƒç´ å¯ä»¥æ­£å¸¸è¿æ¥å½¢æˆæµç¨‹å›¾
- [ ] åŸºæœ¬ç¼–è¾‘åŠŸèƒ½ï¼ˆå¤åˆ¶ã€åˆ é™¤ã€æ’¤é”€ç­‰ï¼‰æ­£å¸¸
- [ ] UIäº¤äº’æµç•…ï¼Œç”¨æˆ·ä½“éªŒè‰¯å¥½
- [ ] å¯ä»¥å®Œå…¨é€šè¿‡UIåˆ›å»ºã€é…ç½®ã€å‘å¸ƒæµç¨‹
- [ ] **é›¶SQL/XMLæ‰‹åŠ¨ç¼–è¾‘**

---

## ğŸš€ é˜¶æ®µ2: å¢å¼ºåŠŸèƒ½ï¼ˆP1ï¼‰

### ä»»åŠ¡2.1: è¡¨å•è®¾è®¡å™¨é›†æˆ â­â­â­â­
**ä¼˜å…ˆçº§**: P1  
**å·¥æ—¶**: 12-16å°æ—¶  
**è´Ÿè´£äºº**: å‰ç«¯+åç«¯  
**ä¾èµ–**: é˜¶æ®µ1å®Œæˆ

#### å­ä»»åŠ¡

##### 2.1.1 æŠ€æœ¯é€‰å‹ä¸è°ƒç ”ï¼ˆ2å°æ—¶ï¼‰

**è¯„ä¼°ä¸‰ä¸ªæ–¹æ¡ˆ**:

**æ–¹æ¡ˆ1: form-jsï¼ˆCamundaå®˜æ–¹ï¼‰**
- âœ… åŸç”Ÿæ”¯æŒCamunda
- âœ… ä¸bpmn-jsé›†æˆåº¦é«˜
- âŒ æ–‡æ¡£è¾ƒå°‘
- âŒ å®šåˆ¶æ€§ä¸€èˆ¬

**æ–¹æ¡ˆ2: vue-form-making**
- âœ… å›½äº§å¼€æºï¼Œæ–‡æ¡£å®Œæ•´
- âœ… Vue3å…¼å®¹
- âœ… ç»„ä»¶ä¸°å¯Œ
- âŒ éœ€è¦é€‚é…Camunda

**æ–¹æ¡ˆ3: è‡ªç ”è½»é‡çº§è¡¨å•è®¾è®¡å™¨**
- âœ… å®Œå…¨å¯æ§
- âœ… è½»é‡çº§
- âŒ å¼€å‘å·¥ä½œé‡å¤§

**æ¨è**: æ–¹æ¡ˆ2ï¼ˆvue-form-makingï¼‰

**éªŒæ”¶æ ‡å‡†**:
- [ ] å®ŒæˆæŠ€æœ¯è¯„ä¼°æ–‡æ¡£
- [ ] ç¡®å®šæœ€ç»ˆæ–¹æ¡ˆ

---

##### 2.1.2 å®‰è£…è¡¨å•è®¾è®¡å™¨ï¼ˆ1å°æ—¶ï¼‰

```bash
npm install vue-form-making@3.0.0
```

---

##### 2.1.3 åˆ›å»ºè¡¨å•è®¾è®¡å™¨ç»„ä»¶ï¼ˆ4å°æ—¶ï¼‰

**åˆ›å»º`FormDesigner.vue`**:

```vue
<template>
  <el-dialog 
    v-model="visible" 
    title="è¡¨å•è®¾è®¡å™¨" 
    width="90%"
    :close-on-click-modal="false"
  >
    <div class="form-designer-container">
      <fm-making-form 
        ref="makingForm"
        :fields="formFields"
        :config="formConfig"
        @save="handleSave"
      />
    </div>
    
    <template #footer>
      <el-button @click="visible = false">å–æ¶ˆ</el-button>
      <el-button type="primary" @click="handleConfirm">ç¡®å®š</el-button>
    </template>
  </el-dialog>
</template>

<script setup>
import { ref } from 'vue'
import { FormMaking } from 'vue-form-making'
import 'vue-form-making/dist/index.css'

const visible = ref(false)
const formFields = ref([])
const formConfig = ref({})

const show = (taskId, existingForm) => {
  visible.value = true
  if (existingForm) {
    formFields.value = existingForm.fields
    formConfig.value = existingForm.config
  }
}

const handleSave = (data) => {
  console.log('è¡¨å•æ•°æ®:', data)
}

const handleConfirm = () => {
  const data = makingForm.value.getData()
  emit('save', data)
  visible.value = false
}

defineExpose({ show })
</script>
```

---

##### 2.1.4 é›†æˆåˆ°æµç¨‹è®¾è®¡å™¨ï¼ˆ3å°æ—¶ï¼‰

**ä¿®æ”¹ProcessDesigner.vue**:

```vue
<template>
  <!-- åŸæœ‰å†…å®¹ -->
  
  <!-- è¡¨å•è®¾è®¡å™¨ç»„ä»¶ -->
  <FormDesigner 
    ref="formDesigner" 
    @save="handleFormSave"
  />
</template>

<script setup>
import FormDesigner from './FormDesigner.vue'

const formDesigner = ref(null)

// åœ¨å±æ€§é¢æ¿ä¸­æ·»åŠ "è®¾è®¡è¡¨å•"æŒ‰é’®
const openFormDesigner = (taskId) => {
  formDesigner.value.show(taskId)
}

// ä¿å­˜è¡¨å•é…ç½®
const handleFormSave = (formData) => {
  // å°†è¡¨å•é…ç½®ä¿å­˜åˆ°ç”¨æˆ·ä»»åŠ¡çš„formKey
  const element = getSelectedElement()
  const modeling = modeler.get('modeling')
  
  modeling.updateProperties(element, {
    'camunda:formKey': `form:${formData.id}`
  })
  
  // ä¿å­˜è¡¨å•å®šä¹‰åˆ°åç«¯
  saveFormDefinition(formData)
}
</script>
```

---

##### 2.1.5 åç«¯APIå¼€å‘ï¼ˆ4å°æ—¶ï¼‰

**åˆ›å»ºè¡¨å•ç›¸å…³è¡¨**:

```sql
-- è¡¨å•å®šä¹‰è¡¨
CREATE TABLE `form_definition` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®',
  `form_key` varchar(100) NOT NULL COMMENT 'è¡¨å•Key',
  `form_name` varchar(100) NOT NULL COMMENT 'è¡¨å•åç§°',
  `form_fields` json NOT NULL COMMENT 'è¡¨å•å­—æ®µå®šä¹‰(JSON)',
  `form_config` json COMMENT 'è¡¨å•é…ç½®(JSON)',
  `version` int(11) NOT NULL DEFAULT 1 COMMENT 'ç‰ˆæœ¬å·',
  `status` varchar(20) NOT NULL DEFAULT 'DRAFT' COMMENT 'çŠ¶æ€:DRAFT-è‰ç¨¿,PUBLISHED-å·²å‘å¸ƒ',
  `create_user` varchar(50) COMMENT 'åˆ›å»ºäºº',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_user` varchar(50) COMMENT 'æ›´æ–°äºº',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_form_key_version` (`form_key`, `version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è¡¨å•å®šä¹‰è¡¨';
```

**åˆ›å»ºController**:

```java
@RestController
@RequestMapping("/workflow/api/form")
public class FormController {
    
    @PostMapping("/save")
    public Map<String, Object> saveForm(@RequestBody FormDTO dto) {
        // ä¿å­˜è¡¨å•å®šä¹‰
    }
    
    @GetMapping("/{formKey}")
    public Map<String, Object> getForm(@PathVariable String formKey) {
        // è·å–è¡¨å•å®šä¹‰
    }
    
    @PostMapping("/publish")
    public Map<String, Object> publishForm(@RequestParam Long id) {
        // å‘å¸ƒè¡¨å•
    }
}
```

---

**ä»»åŠ¡2.1éªŒæ”¶æ ‡å‡†**:
- [ ] å¯ä»¥æ‰“å¼€è¡¨å•è®¾è®¡å™¨
- [ ] å¯ä»¥æ‹–æ‹½æ·»åŠ è¡¨å•å­—æ®µ
- [ ] å¯ä»¥é…ç½®å­—æ®µå±æ€§ï¼ˆå¿…å¡«ã€é»˜è®¤å€¼ç­‰ï¼‰
- [ ] å¯ä»¥é¢„è§ˆè¡¨å•æ•ˆæœ
- [ ] è¡¨å•å®šä¹‰ä¿å­˜åˆ°æ•°æ®åº“
- [ ] ç”¨æˆ·ä»»åŠ¡å…³è”è¡¨å•Key

---

### ä»»åŠ¡2.2: å®æ—¶éªŒè¯ä¸æ™ºèƒ½æç¤º â­â­â­â­
**ä¼˜å…ˆçº§**: P1  
**å·¥æ—¶**: 8-10å°æ—¶  
**è´Ÿè´£äºº**: å‰ç«¯å¼€å‘  
**ä¾èµ–**: é˜¶æ®µ1å®Œæˆ

#### å­ä»»åŠ¡

##### 2.2.1 å®ç°BPMNéªŒè¯å¼•æ“ï¼ˆ4å°æ—¶ï¼‰

**åˆ›å»º`bpmnValidator.js`**:

```javascript
export class BpmnValidator {
  constructor(modeler) {
    this.modeler = modeler
    this.elementRegistry = modeler.get('elementRegistry')
    this.canvas = modeler.get('canvas')
  }
  
  validate() {
    const errors = []
    const warnings = []
    
    // éªŒè¯è§„åˆ™1: æµç¨‹å¿…é¡»æœ‰å¼€å§‹äº‹ä»¶
    const startEvents = this.elementRegistry.filter(
      el => el.type === 'bpmn:StartEvent'
    )
    if (startEvents.length === 0) {
      errors.push({
        type: 'error',
        message: 'æµç¨‹å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªå¼€å§‹äº‹ä»¶',
        elementId: null
      })
    }
    
    // éªŒè¯è§„åˆ™2: æµç¨‹å¿…é¡»æœ‰ç»“æŸäº‹ä»¶
    const endEvents = this.elementRegistry.filter(
      el => el.type === 'bpmn:EndEvent'
    )
    if (endEvents.length === 0) {
      errors.push({
        type: 'error',
        message: 'æµç¨‹å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªç»“æŸäº‹ä»¶',
        elementId: null
      })
    }
    
    // éªŒè¯è§„åˆ™3: ç”¨æˆ·ä»»åŠ¡å¿…é¡»æœ‰assignee
    const userTasks = this.elementRegistry.filter(
      el => el.type === 'bpmn:UserTask'
    )
    userTasks.forEach(task => {
      const bo = task.businessObject
      if (!bo.assignee && !bo.candidateUsers && !bo.candidateGroups) {
        errors.push({
          type: 'error',
          message: `ç”¨æˆ·ä»»åŠ¡"${bo.name || task.id}"ç¼ºå°‘assigneeé…ç½®`,
          elementId: task.id,
          element: task
        })
      }
    })
    
    // éªŒè¯è§„åˆ™4: å…ƒç´ å¿…é¡»æœ‰è¿æ¥
    this.elementRegistry.forEach(element => {
      if (this.isFlowNode(element)) {
        const incoming = element.incoming || []
        const outgoing = element.outgoing || []
        
        if (element.type !== 'bpmn:StartEvent' && incoming.length === 0) {
          warnings.push({
            type: 'warning',
            message: `å…ƒç´ "${element.businessObject.name || element.id}"æ²¡æœ‰è¾“å…¥è¿æ¥`,
            elementId: element.id,
            element: element
          })
        }
        
        if (element.type !== 'bpmn:EndEvent' && outgoing.length === 0) {
          warnings.push({
            type: 'warning',
            message: `å…ƒç´ "${element.businessObject.name || element.id}"æ²¡æœ‰è¾“å‡ºè¿æ¥`,
            elementId: element.id,
            element: element
          })
        }
      }
    })
    
    // éªŒè¯è§„åˆ™5: ç½‘å…³å¿…é¡»æœ‰æ¡ä»¶
    const gateways = this.elementRegistry.filter(
      el => el.type === 'bpmn:ExclusiveGateway' || el.type === 'bpmn:InclusiveGateway'
    )
    gateways.forEach(gateway => {
      const outgoing = gateway.outgoing || []
      outgoing.forEach(flow => {
        if (!flow.businessObject.conditionExpression) {
          warnings.push({
            type: 'warning',
            message: `ç½‘å…³å‡ºå£æµ"${flow.id}"ç¼ºå°‘æ¡ä»¶è¡¨è¾¾å¼`,
            elementId: flow.id,
            element: flow
          })
        }
      })
    })
    
    return { errors, warnings }
  }
  
  isFlowNode(element) {
    return element.type && (
      element.type.includes('Task') ||
      element.type.includes('Event') ||
      element.type.includes('Gateway')
    )
  }
  
  // é«˜äº®é”™è¯¯å…ƒç´ 
  highlightErrors(errors) {
    errors.forEach(error => {
      if (error.elementId) {
        this.canvas.addMarker(error.elementId, 'error-marker')
      }
    })
  }
  
  // é«˜äº®è­¦å‘Šå…ƒç´ 
  highlightWarnings(warnings) {
    warnings.forEach(warning => {
      if (warning.elementId) {
        this.canvas.addMarker(warning.elementId, 'warning-marker')
      }
    })
  }
  
  // æ¸…é™¤æ‰€æœ‰æ ‡è®°
  clearMarkers() {
    this.elementRegistry.forEach(element => {
      this.canvas.removeMarker(element.id, 'error-marker')
      this.canvas.removeMarker(element.id, 'warning-marker')
    })
  }
}
```

**åœ¨ProcessDesigner.vueä¸­ä½¿ç”¨**:

```javascript
import { BpmnValidator } from './utils/bpmnValidator'

let validator = null

const initBpmnModeler = () => {
  // ... modeleråˆå§‹åŒ–
  
  // åˆ›å»ºéªŒè¯å™¨
  validator = new BpmnValidator(modeler)
  
  // ç›‘å¬å˜åŒ–ï¼Œå®æ—¶éªŒè¯
  modeler.on('commandStack.changed', () => {
    debounceValidate()
  })
}

// é˜²æŠ–éªŒè¯
let validateTimer = null
const debounceValidate = () => {
  if (validateTimer) {
    clearTimeout(validateTimer)
  }
  validateTimer = setTimeout(() => {
    const result = validator.validate()
    validator.clearMarkers()
    validator.highlightErrors(result.errors)
    validator.highlightWarnings(result.warnings)
    
    // æ˜¾ç¤ºéªŒè¯ç»“æœ
    showValidationResult(result)
  }, 500)
}

// æ˜¾ç¤ºéªŒè¯ç»“æœ
const showValidationResult = (result) => {
  if (result.errors.length > 0) {
    ElMessage.warning(`å‘ç°${result.errors.length}ä¸ªé”™è¯¯`)
  } else if (result.warnings.length > 0) {
    ElMessage.info(`å‘ç°${result.warnings.length}ä¸ªè­¦å‘Š`)
  }
}
```

**æ·»åŠ CSSæ ·å¼**:

```css
:deep(.error-marker) {
  stroke: #f56c6c !important;
  stroke-width: 3px !important;
  fill: rgba(245, 108, 108, 0.1) !important;
}

:deep(.warning-marker) {
  stroke: #e6a23c !important;
  stroke-width: 2px !important;
  fill: rgba(230, 162, 60, 0.1) !important;
}
```

---

##### 2.2.2 æ·»åŠ éªŒè¯ç»“æœé¢æ¿ï¼ˆ2å°æ—¶ï¼‰

**åœ¨ProcessDesigner.vueä¸­æ·»åŠ **:

```vue
<template>
  <!-- åŸæœ‰å†…å®¹ -->
  
  <!-- éªŒè¯ç»“æœé¢æ¿ -->
  <div v-if="showValidationPanel" class="validation-panel">
    <div class="validation-header">
      <span>éªŒè¯ç»“æœ</span>
      <el-button text @click="showValidationPanel = false">
        <el-icon><Close /></el-icon>
      </el-button>
    </div>
    
    <div class="validation-content">
      <!-- é”™è¯¯åˆ—è¡¨ -->
      <div v-if="validationResult.errors.length > 0" class="validation-section">
        <div class="section-title error-title">
          <el-icon><CircleClose /></el-icon>
          é”™è¯¯ ({{ validationResult.errors.length }})
        </div>
        <div 
          v-for="(error, index) in validationResult.errors"
          :key="index"
          class="validation-item error-item"
          @click="locateElement(error.elementId)"
        >
          <el-icon><Warning /></el-icon>
          <span>{{ error.message }}</span>
        </div>
      </div>
      
      <!-- è­¦å‘Šåˆ—è¡¨ -->
      <div v-if="validationResult.warnings.length > 0" class="validation-section">
        <div class="section-title warning-title">
          <el-icon><WarningFilled /></el-icon>
          è­¦å‘Š ({{ validationResult.warnings.length }})
        </div>
        <div 
          v-for="(warning, index) in validationResult.warnings"
          :key="index"
          class="validation-item warning-item"
          @click="locateElement(warning.elementId)"
        >
          <el-icon><InfoFilled /></el-icon>
          <span>{{ warning.message }}</span>
        </div>
      </div>
      
      <!-- é€šè¿‡æç¤º -->
      <div v-if="validationResult.errors.length === 0 && validationResult.warnings.length === 0" class="validation-section">
        <div class="section-title success-title">
          <el-icon><CircleCheck /></el-icon>
          éªŒè¯é€šè¿‡
        </div>
        <div class="validation-success">
          âœ… æµç¨‹å®šä¹‰æ²¡æœ‰å‘ç°ä»»ä½•é—®é¢˜ï¼Œå¯ä»¥å®‰å…¨å‘å¸ƒï¼
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { CircleClose, WarningFilled, InfoFilled, CircleCheck, Warning, Close } from '@element-plus/icons-vue'

const showValidationPanel = ref(false)
const validationResult = ref({ errors: [], warnings: [] })

// å®šä½åˆ°é”™è¯¯å…ƒç´ 
const locateElement = (elementId) => {
  if (!elementId || !modeler) return
  
  const elementRegistry = modeler.get('elementRegistry')
  const selection = modeler.get('selection')
  const canvas = modeler.get('canvas')
  
  const element = elementRegistry.get(elementId)
  if (element) {
    // é€‰ä¸­å…ƒç´ 
    selection.select(element)
    // å±…ä¸­æ˜¾ç¤º
    canvas.scrollToElement(element)
  }
}
</script>

<style scoped>
.validation-panel {
  position: fixed;
  bottom: 20px;
  right: 340px;
  width: 350px;
  max-height: 400px;
  background: #fff;
  border: 1px solid #e4e7ed;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  z-index: 100;
}

.validation-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 15px;
  border-bottom: 1px solid #e4e7ed;
  font-weight: 600;
  background: #f5f7fa;
  border-radius: 8px 8px 0 0;
}

.validation-content {
  max-height: 340px;
  overflow-y: auto;
  padding: 10px;
}

.validation-section {
  margin-bottom: 15px;
}

.section-title {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 13px;
  font-weight: 600;
  margin-bottom: 8px;
  padding: 6px 10px;
  border-radius: 4px;
}

.error-title {
  background: #fef0f0;
  color: #f56c6c;
}

.warning-title {
  background: #fdf6ec;
  color: #e6a23c;
}

.success-title {
  background: #f0f9ff;
  color: #67c23a;
}

.validation-item {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  padding: 10px;
  margin-bottom: 6px;
  border-radius: 4px;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s;
}

.error-item {
  background: #fef0f0;
  color: #f56c6c;
  border-left: 3px solid #f56c6c;
}

.error-item:hover {
  background: #fde2e2;
}

.warning-item {
  background: #fdf6ec;
  color: #e6a23c;
  border-left: 3px solid #e6a23c;
}

.warning-item:hover {
  background: #faecd8;
}

.validation-success {
  padding: 20px;
  text-align: center;
  color: #67c23a;
  font-size: 14px;
}
</style>
```

---

##### 2.2.3 æ·»åŠ æ™ºèƒ½ä¿®å¤å»ºè®®ï¼ˆ2å°æ—¶ï¼‰

**åœ¨éªŒè¯é¡¹ä¸­æ·»åŠ ä¿®å¤å»ºè®®**:

```javascript
// åœ¨bpmnValidator.jsä¸­ä¸ºæ¯ä¸ªé”™è¯¯æ·»åŠ ä¿®å¤å»ºè®®
{
  type: 'error',
  message: 'ç”¨æˆ·ä»»åŠ¡ç¼ºå°‘assigneeé…ç½®',
  elementId: task.id,
  fix: {
    label: 'å¿«é€Ÿä¿®å¤',
    action: () => {
      // æ‰“å¼€å±æ€§é¢æ¿å¹¶èšç„¦åˆ°assigneeå­—æ®µ
      selectElement(task.id)
      focusAssigneeField()
    }
  }
}
```

---

**ä»»åŠ¡2.2éªŒæ”¶æ ‡å‡†**:
- [ ] æµç¨‹å˜åŒ–æ—¶è‡ªåŠ¨éªŒè¯
- [ ] é”™è¯¯å…ƒç´ çº¢è‰²é«˜äº®
- [ ] è­¦å‘Šå…ƒç´ é»„è‰²é«˜äº®
- [ ] éªŒè¯ç»“æœé¢æ¿æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
- [ ] ç‚¹å‡»é”™è¯¯é¡¹å¯å®šä½åˆ°å…ƒç´ 
- [ ] æ™ºèƒ½ä¿®å¤å»ºè®®å¯ç”¨

---

*ç”±äºç¯‡å¹…é™åˆ¶ï¼Œå®Œæ•´çš„å·¥ä½œè®¡åˆ’å°†ç»§ç»­åœ¨ä¸‹ä¸€ä¸ªå›å¤ä¸­...*

---

## ğŸ“ æ€»ç»“

ä»¥ä¸Šæ˜¯**é˜¶æ®µ1ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰å’Œé˜¶æ®µ2å‰åŠéƒ¨åˆ†ï¼ˆè¡¨å•è®¾è®¡å™¨+å®æ—¶éªŒè¯ï¼‰**çš„è¯¦ç»†å·¥ä½œè®¡åˆ’ã€‚

**å…³é”®è¦ç‚¹**:
1. æ¯ä¸ªä»»åŠ¡éƒ½æœ‰æ˜ç¡®çš„å­ä»»åŠ¡å’ŒéªŒæ”¶æ ‡å‡†
2. æä¾›äº†å…·ä½“çš„ä»£ç å®ç°ç¤ºä¾‹
3. æ ‡æ³¨äº†å·¥æ—¶ã€ä¼˜å…ˆçº§å’Œä¾èµ–å…³ç³»
4. ä¾¿äºè®¨è®ºå’Œè°ƒæ•´

**æ¥ä¸‹æ¥éœ€è¦è®¨è®º**:
1. æ˜¯å¦æ¥å—è¿™ä¸ªå·¥ä½œé‡è¯„ä¼°ï¼Ÿ
2. æ˜¯å¦éœ€è¦è°ƒæ•´ä¼˜å…ˆçº§ï¼Ÿ
3. æ˜¯å¦éœ€è¦æ›´è¯¦ç»†çš„æŸä¸ªä»»åŠ¡åˆ†è§£ï¼Ÿ
4. ä½•æ—¶å¼€å§‹å®æ–½ï¼Ÿ

è¯·å‘Šè¯‰æˆ‘æ‚¨çš„æƒ³æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­ç»†åŒ–åç»­çš„é˜¶æ®µ3ï¼ˆé«˜çº§åŠŸèƒ½ï¼‰ï¼

