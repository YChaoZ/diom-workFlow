# Viteä»£ç†é…ç½®è¯¦è§£

## ğŸ¯ ä»€ä¹ˆæ˜¯Viteä»£ç†ï¼Ÿ

Viteä»£ç†æ˜¯åœ¨**å¼€å‘ç¯å¢ƒ**ä¸‹ï¼Œè§£å†³**æµè§ˆå™¨è·¨åŸŸé—®é¢˜**çš„æ–¹æ¡ˆã€‚å®ƒå°†å‰ç«¯è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨ã€‚

---

## ğŸ“ é…ç½®ä½ç½®

**æ–‡ä»¶**: `diom-frontend/vite.config.js` (ç¬¬13-33è¡Œ)

```javascript
server: {
  port: 3000,           // âœ… å‰ç«¯è¿è¡Œåœ¨ http://localhost:3000
  proxy: {
    '/api': {
      target: 'http://localhost:8080',    // âœ… è½¬å‘åˆ°Gateway
      changeOrigin: true
    },
    '/auth': {
      target: 'http://localhost:8080',
      changeOrigin: true
    },
    '/workflow': {
      target: 'http://localhost:8080',
      changeOrigin: true
    },
    '/user': {
      target: 'http://localhost:8080',
      changeOrigin: true
    }
  }
}
```

---

## ğŸ”„ ä»£ç†å·¥ä½œæµç¨‹

### 1ï¸âƒ£ å‰ç«¯APIè°ƒç”¨

**æ–‡ä»¶**: `diom-frontend/src/api/auth.js`

```javascript
// å‰ç«¯ä»£ç ï¼šç™»å½•API
export function login(data) {
  return request({
    url: '/auth/login',    // âš ï¸ æ³¨æ„ï¼šè¿™é‡Œåªå†™äº†ç›¸å¯¹è·¯å¾„
    method: 'post',
    data
  })
}
```

### 2ï¸âƒ£ Axiosé…ç½®

**æ–‡ä»¶**: `diom-frontend/src/utils/request.js` (ç¬¬6-8è¡Œ)

```javascript
const service = axios.create({
  baseURL: 'http://localhost:8080',  // âš ï¸ è¿™ä¸ªé…ç½®åœ¨ç”Ÿäº§ç¯å¢ƒæœ‰æ•ˆ
  timeout: 10000
})
```

### 3ï¸âƒ£ å®Œæ•´è¯·æ±‚è·¯å¾„

å½“ä½ è°ƒç”¨ `login()` æ—¶ï¼Œå®Œæ•´è·¯å¾„æ˜¯ï¼š

```
baseURL + url = http://localhost:8080 + /auth/login
                = http://localhost:8080/auth/login
```

### 4ï¸âƒ£ Viteä»£ç†æ‹¦æˆª

ä½†åœ¨**å¼€å‘ç¯å¢ƒ**ä¸­ï¼Œæµè§ˆå™¨å®é™…å‘é€çš„è¯·æ±‚æ˜¯ï¼š

```
http://localhost:3000/auth/login  (å‰ç«¯å¼€å‘æœåŠ¡å™¨)
```

**Viteçœ‹åˆ° `/auth` å‰ç¼€ï¼Œè§¦å‘ä»£ç†è§„åˆ™**ï¼š

```javascript
'/auth': {
  target: 'http://localhost:8080',  // è½¬å‘åˆ°Gateway
  changeOrigin: true                // ä¿®æ”¹Originå¤´ï¼Œé¿å…CORS
}
```

### 5ï¸âƒ£ ä»£ç†è½¬å‘

Viteå°†è¯·æ±‚è½¬å‘åˆ°ï¼š

```
http://localhost:8080/auth/login  (Gateway)
```

---

## ğŸ“Š å®Œæ•´è°ƒç”¨é“¾è·¯å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å‰ç«¯ä»£ç è°ƒç”¨                                               â”‚
â”‚    login({ username: 'admin', password: '123456' })         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Axioså‘é€è¯·æ±‚                                             â”‚
â”‚    POST http://localhost:3000/auth/login  (å¼€å‘ç¯å¢ƒ)        â”‚
â”‚    POST http://localhost:8080/auth/login  (ç”Ÿäº§ç¯å¢ƒ)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Viteä»£ç†æ‹¦æˆªï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰                                 â”‚
â”‚    æ£€æµ‹åˆ° /auth å‰ç¼€                                         â”‚
â”‚    è§¦å‘ä»£ç†è§„åˆ™ï¼štarget = http://localhost:8080             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. è½¬å‘åˆ°Gateway                                             â”‚
â”‚    POST http://localhost:8080/auth/login                    â”‚
â”‚    Origin: http://localhost:8080 (changeOriginä¿®æ”¹)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Gatewayè·¯ç”±åˆ°è®¤è¯æœåŠ¡                                      â”‚
â”‚    è·¯ç”±è§„åˆ™ï¼š/auth/** â†’ lb://diom-auth-service              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. è®¤è¯æœåŠ¡å¤„ç†                                               â”‚
â”‚    diom-auth-service:8081                                    â”‚
â”‚    éªŒè¯ç”¨æˆ·åå¯†ç ï¼Œç”ŸæˆJWT Token                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. å“åº”è¿”å›                                                   â”‚
â”‚    Gateway â†’ Vite Proxy â†’ æµè§ˆå™¨                            â”‚
â”‚    { code: 200, data: { token: 'xxx' } }                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” å¦‚ä½•éªŒè¯ä»£ç†ç”Ÿæ•ˆï¼Ÿ

### æ–¹æ³•1ï¼šæµè§ˆå™¨Networké¢æ¿

1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. åˆ‡æ¢åˆ° **Network** æ ‡ç­¾
3. ç™»å½•æ“ä½œ
4. æŸ¥çœ‹è¯·æ±‚è¯¦æƒ…ï¼š

```
Request URL: http://localhost:3000/auth/login  âœ… ä»£ç†ç”Ÿæ•ˆ
Status: 200
```

### æ–¹æ³•2ï¼šæŸ¥çœ‹å‰ç«¯æ—¥å¿—

```bash
cd /Users/yanchao/IdeaProjects/diom-workFlow/diom-frontend
npm run dev
```

è¾“å‡ºï¼š

```
  âœ  Local:   http://localhost:3000/
  âœ  Network: use --host to expose
  âœ  press h + enter to show help
  
  âœ“ ä»£ç†é…ç½®å·²åŠ è½½ï¼š/api, /auth, /workflow, /user
```

---

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### 1. ä»…å¼€å‘ç¯å¢ƒæœ‰æ•ˆ

Viteä»£ç†**åªåœ¨å¼€å‘ç¯å¢ƒ**ï¼ˆ`npm run dev`ï¼‰ç”Ÿæ•ˆï¼Œ**ç”Ÿäº§ç¯å¢ƒ**ï¼ˆ`npm run build`ï¼‰ä¸ç”Ÿæ•ˆã€‚

**ç”Ÿäº§ç¯å¢ƒ**ï¼š
- å‰ç«¯æ‰“åŒ…æˆé™æ€æ–‡ä»¶ï¼ˆHTML/CSS/JSï¼‰
- éƒ¨ç½²åˆ°WebæœåŠ¡å™¨ï¼ˆå¦‚Nginxï¼‰
- ç›´æ¥è¯·æ±‚ `http://localhost:8080/auth/login`ï¼ˆGatewayï¼‰

### 2. ä¸ºä»€ä¹ˆéœ€è¦ä»£ç†ï¼Ÿ

**é—®é¢˜**ï¼šæµè§ˆå™¨åŒæºç­–ç•¥ï¼ˆCORSï¼‰

```
å‰ç«¯ï¼šhttp://localhost:3000
åç«¯ï¼šhttp://localhost:8080
âŒ ä¸åŒç«¯å£ = è·¨åŸŸ = æµè§ˆå™¨é˜»æ­¢
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|
| **Viteä»£ç†**ï¼ˆå½“å‰ä½¿ç”¨ï¼‰ | ç®€å•ï¼Œæ— éœ€åç«¯æ”¹åŠ¨ | ä»…å¼€å‘ç¯å¢ƒ |
| **åç«¯CORSé…ç½®** | ç”Ÿäº§ç¯å¢ƒä¹Ÿå¯ç”¨ | éœ€è¦åç«¯é…ç½® |
| **Nginxåå‘ä»£ç†** | ç»Ÿä¸€åŸŸåï¼Œæ— è·¨åŸŸ | éœ€è¦é¢å¤–éƒ¨ç½² |

### 3. changeOriginä½œç”¨

```javascript
'/auth': {
  target: 'http://localhost:8080',
  changeOrigin: true  // âœ… ä¿®æ”¹è¯·æ±‚å¤´çš„Origin
}
```

**ä½œç”¨**ï¼šå°†è¯·æ±‚å¤´çš„ `Origin` ä» `http://localhost:3000` æ”¹ä¸º `http://localhost:8080`ï¼Œè®©åç«¯è®¤ä¸ºè¯·æ±‚æ¥è‡ªåŒä¸€åŸŸåã€‚

---

## ğŸ“ ä»£ç†é…ç½®å¯¹åº”å…³ç³»

| å‰ç«¯APIè·¯å¾„ | Viteä»£ç†è§„åˆ™ | è½¬å‘åˆ°Gateway | Gatewayè·¯ç”± | æœ€ç»ˆæœåŠ¡ |
|------------|-------------|--------------|------------|----------|
| `/auth/login` | `/auth` â†’ 8080 | `http://localhost:8080/auth/login` | `/auth/**` | `diom-auth-service:8081` |
| `/workflow/tasks` | `/workflow` â†’ 8080 | `http://localhost:8080/workflow/tasks` | `/workflow/**` | `diom-workflow-service:8085` |
| `/user/list` | `/user` â†’ 8080 | `http://localhost:8080/user/list` | `/user/**` | `diom-web-service:8082` |
| `/api/process-design/list` | `/api` â†’ 8080 | `http://localhost:8080/api/process-design/list` | `/api/**` | `diom-workflow-service:8085` |

---

## ğŸ¯ æ€»ç»“

1. **Viteä»£ç†é…ç½®åœ¨**: `vite.config.js` çš„ `server.proxy`
2. **å‰ç«¯APIè°ƒç”¨**: ä½¿ç”¨**ç›¸å¯¹è·¯å¾„**ï¼ˆå¦‚ `/auth/login`ï¼‰
3. **ä»£ç†å·¥ä½œæµç¨‹**: 
   - æµè§ˆå™¨è¯·æ±‚ â†’ Viteå¼€å‘æœåŠ¡å™¨ï¼ˆ3000ç«¯å£ï¼‰
   - ViteåŒ¹é…ä»£ç†è§„åˆ™ â†’ è½¬å‘åˆ°Gatewayï¼ˆ8080ç«¯å£ï¼‰
   - Gatewayè·¯ç”± â†’ å…·ä½“çš„å¾®æœåŠ¡
4. **ä»…å¼€å‘ç¯å¢ƒ**: ç”Ÿäº§ç¯å¢ƒä¸ä½¿ç”¨ä»£ç†ï¼Œç›´æ¥è¯·æ±‚Gateway
5. **è§£å†³è·¨åŸŸé—®é¢˜**: é€šè¿‡ `changeOrigin: true` ä¿®æ”¹Originå¤´

---

## ğŸ”§ å¦‚ä½•ä¿®æ”¹ä»£ç†é…ç½®ï¼Ÿ

**ç¤ºä¾‹**ï¼šæ·»åŠ æ–°çš„APIè·¯å¾„ä»£ç†

```javascript
// vite.config.js
server: {
  port: 3000,
  proxy: {
    '/api': { target: 'http://localhost:8080', changeOrigin: true },
    '/auth': { target: 'http://localhost:8080', changeOrigin: true },
    '/workflow': { target: 'http://localhost:8080', changeOrigin: true },
    '/user': { target: 'http://localhost:8080', changeOrigin: true },
    '/newapi': {  // âœ… æ–°å¢
      target: 'http://localhost:8080',
      changeOrigin: true
    }
  }
}
```

**ä¿®æ”¹åéœ€è¦é‡å¯å‰ç«¯**ï¼š

```bash
cd diom-frontend
pkill -f "vite"
npm run dev
```

---

**ç”Ÿæˆæ—¶é—´**: 2025-11-15  
**ä½œè€…**: AI Assistant

